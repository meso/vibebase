(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();var Re,q,Bt,ve,Ft,Ht,Vt,Wt,lt,tt,nt,Jt,Ie={},Gt=[],jn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Pe=Array.isArray;function ge(t,n){for(var r in n)t[r]=n[r];return t}function ct(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Ue(t,n,r){var a,o,i,d={};for(i in n)i=="key"?a=n[i]:i=="ref"?o=n[i]:d[i]=n[i];if(arguments.length>2&&(d.children=arguments.length>3?Re.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)d[i]===void 0&&(d[i]=t.defaultProps[i]);return De(t,d,a,o,null)}function De(t,n,r,a,o){var i={type:t,props:n,key:r,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++Bt,__i:-1,__u:0};return o==null&&q.vnode!=null&&q.vnode(i),i}function Ve(t){return t.children}function Ne(t,n){this.props=t,this.context=n}function Te(t,n){if(n==null)return t.__?Te(t.__,t.__i+1):null;for(var r;n<t.__k.length;n++)if((r=t.__k[n])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?Te(t):null}function Qt(t){var n,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,n=0;n<t.__k.length;n++)if((r=t.__k[n])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return Qt(t)}}function rt(t){(!t.__d&&(t.__d=!0)&&ve.push(t)&&!Be.__r++||Ft!=q.debounceRendering)&&((Ft=q.debounceRendering)||Ht)(Be)}function Be(){for(var t,n,r,a,o,i,d,p=1;ve.length;)ve.length>p&&ve.sort(Vt),t=ve.shift(),p=ve.length,t.__d&&(r=void 0,o=(a=(n=t).__v).__e,i=[],d=[],n.__P&&((r=ge({},a)).__v=a.__v+1,q.vnode&&q.vnode(r),dt(n.__P,r,a,n.__n,n.__P.namespaceURI,32&a.__u?[o]:null,i,o??Te(a),!!(32&a.__u),d),r.__v=a.__v,r.__.__k[r.__i]=r,Yt(i,r,d),r.__e!=o&&Qt(r)));Be.__r=0}function Zt(t,n,r,a,o,i,d,p,x,g,$){var c,_,u,b,T,k,A=a&&a.__k||Gt,j=n.length;for(x=Fn(r,n,A,x,j),c=0;c<j;c++)(u=r.__k[c])!=null&&(_=u.__i==-1?Ie:A[u.__i]||Ie,u.__i=c,k=dt(t,u,_,o,i,d,p,x,g,$),b=u.__e,u.ref&&_.ref!=u.ref&&(_.ref&&ut(_.ref,null,u),$.push(u.ref,u.__c||b,u)),T==null&&b!=null&&(T=b),4&u.__u||_.__k===u.__k?x=Xt(u,x,t):typeof u.type=="function"&&k!==void 0?x=k:b&&(x=b.nextSibling),u.__u&=-7);return r.__e=T,x}function Fn(t,n,r,a,o){var i,d,p,x,g,$=r.length,c=$,_=0;for(t.__k=new Array(o),i=0;i<o;i++)(d=n[i])!=null&&typeof d!="boolean"&&typeof d!="function"?(x=i+_,(d=t.__k[i]=typeof d=="string"||typeof d=="number"||typeof d=="bigint"||d.constructor==String?De(null,d,null,null,null):Pe(d)?De(Ve,{children:d},null,null,null):d.constructor==null&&d.__b>0?De(d.type,d.props,d.key,d.ref?d.ref:null,d.__v):d).__=t,d.__b=t.__b+1,p=null,(g=d.__i=Ln(d,r,x,c))!=-1&&(c--,(p=r[g])&&(p.__u|=2)),p==null||p.__v==null?(g==-1&&(o>$?_--:o<$&&_++),typeof d.type!="function"&&(d.__u|=4)):g!=x&&(g==x-1?_--:g==x+1?_++:(g>x?_--:_++,d.__u|=4))):t.__k[i]=null;if(c)for(i=0;i<$;i++)(p=r[i])!=null&&!(2&p.__u)&&(p.__e==a&&(a=Te(p)),tn(p,p));return a}function Xt(t,n,r){var a,o;if(typeof t.type=="function"){for(a=t.__k,o=0;a&&o<a.length;o++)a[o]&&(a[o].__=t,n=Xt(a[o],n,r));return n}t.__e!=n&&(n&&t.type&&!r.contains(n)&&(n=Te(t)),r.insertBefore(t.__e,n||null),n=t.__e);do n=n&&n.nextSibling;while(n!=null&&n.nodeType==8);return n}function st(t,n){return n=n||[],t==null||typeof t=="boolean"||(Pe(t)?t.some(function(r){st(r,n)}):n.push(t)),n}function Ln(t,n,r,a){var o,i,d=t.key,p=t.type,x=n[r];if(x===null&&t.key==null||x&&d==x.key&&p==x.type&&!(2&x.__u))return r;if(a>(x!=null&&!(2&x.__u)?1:0))for(o=r-1,i=r+1;o>=0||i<n.length;){if(o>=0){if((x=n[o])&&!(2&x.__u)&&d==x.key&&p==x.type)return o;o--}if(i<n.length){if((x=n[i])&&!(2&x.__u)&&d==x.key&&p==x.type)return i;i++}}return-1}function Lt(t,n,r){n[0]=="-"?t.setProperty(n,r??""):t[n]=r==null?"":typeof r!="number"||jn.test(n)?r:r+"px"}function qe(t,n,r,a,o){var i,d;e:if(n=="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof a=="string"&&(t.style.cssText=a=""),a)for(n in a)r&&n in r||Lt(t.style,n,"");if(r)for(n in r)a&&r[n]==a[n]||Lt(t.style,n,r[n])}else if(n[0]=="o"&&n[1]=="n")i=n!=(n=n.replace(Wt,"$1")),d=n.toLowerCase(),n=d in t||n=="onFocusOut"||n=="onFocusIn"?d.slice(2):n.slice(2),t.l||(t.l={}),t.l[n+i]=r,r?a?r.u=a.u:(r.u=lt,t.addEventListener(n,i?nt:tt,i)):t.removeEventListener(n,i?nt:tt,i);else{if(o=="http://www.w3.org/2000/svg")n=n.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(n!="width"&&n!="height"&&n!="href"&&n!="list"&&n!="form"&&n!="tabIndex"&&n!="download"&&n!="rowSpan"&&n!="colSpan"&&n!="role"&&n!="popover"&&n in t)try{t[n]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&n[4]!="-"?t.removeAttribute(n):t.setAttribute(n,n=="popover"&&r==1?"":r))}}function Dt(t){return function(n){if(this.l){var r=this.l[n.type+t];if(n.t==null)n.t=lt++;else if(n.t<r.u)return;return r(q.event?q.event(n):n)}}}function dt(t,n,r,a,o,i,d,p,x,g){var $,c,_,u,b,T,k,A,j,F,E,R,M,te,W,ne,le,G=n.type;if(n.constructor!=null)return null;128&r.__u&&(x=!!(32&r.__u),i=[p=n.__e=r.__e]),($=q.__b)&&$(n);e:if(typeof G=="function")try{if(A=n.props,j="prototype"in G&&G.prototype.render,F=($=G.contextType)&&a[$.__c],E=$?F?F.props.value:$.__:a,r.__c?k=(c=n.__c=r.__c).__=c.__E:(j?n.__c=c=new G(A,E):(n.__c=c=new Ne(A,E),c.constructor=G,c.render=Nn),F&&F.sub(c),c.props=A,c.state||(c.state={}),c.context=E,c.__n=a,_=c.__d=!0,c.__h=[],c._sb=[]),j&&c.__s==null&&(c.__s=c.state),j&&G.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=ge({},c.__s)),ge(c.__s,G.getDerivedStateFromProps(A,c.__s))),u=c.props,b=c.state,c.__v=n,_)j&&G.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),j&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(j&&G.getDerivedStateFromProps==null&&A!==u&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(A,E),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(A,c.__s,E)===!1||n.__v==r.__v){for(n.__v!=r.__v&&(c.props=A,c.state=c.__s,c.__d=!1),n.__e=r.__e,n.__k=r.__k,n.__k.some(function(O){O&&(O.__=n)}),R=0;R<c._sb.length;R++)c.__h.push(c._sb[R]);c._sb=[],c.__h.length&&d.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(A,c.__s,E),j&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(u,b,T)})}if(c.context=E,c.props=A,c.__P=t,c.__e=!1,M=q.__r,te=0,j){for(c.state=c.__s,c.__d=!1,M&&M(n),$=c.render(c.props,c.state,c.context),W=0;W<c._sb.length;W++)c.__h.push(c._sb[W]);c._sb=[]}else do c.__d=!1,M&&M(n),$=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++te<25);c.state=c.__s,c.getChildContext!=null&&(a=ge(ge({},a),c.getChildContext())),j&&!_&&c.getSnapshotBeforeUpdate!=null&&(T=c.getSnapshotBeforeUpdate(u,b)),ne=$,$!=null&&$.type===Ve&&$.key==null&&(ne=en($.props.children)),p=Zt(t,Pe(ne)?ne:[ne],n,r,a,o,i,d,p,x,g),c.base=n.__e,n.__u&=-161,c.__h.length&&d.push(c),k&&(c.__E=c.__=null)}catch(O){if(n.__v=null,x||i!=null)if(O.then){for(n.__u|=x?160:128;p&&p.nodeType==8&&p.nextSibling;)p=p.nextSibling;i[i.indexOf(p)]=null,n.__e=p}else for(le=i.length;le--;)ct(i[le]);else n.__e=r.__e,n.__k=r.__k;q.__e(O,n,r)}else i==null&&n.__v==r.__v?(n.__k=r.__k,n.__e=r.__e):p=n.__e=Dn(r.__e,n,r,a,o,i,d,x,g);return($=q.diffed)&&$(n),128&n.__u?void 0:p}function Yt(t,n,r){for(var a=0;a<r.length;a++)ut(r[a],r[++a],r[++a]);q.__c&&q.__c(n,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(i){i.call(o)})}catch(i){q.__e(i,o.__v)}})}function en(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:Pe(t)?t.map(en):ge({},t)}function Dn(t,n,r,a,o,i,d,p,x){var g,$,c,_,u,b,T,k=r.props,A=n.props,j=n.type;if(j=="svg"?o="http://www.w3.org/2000/svg":j=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(g=0;g<i.length;g++)if((u=i[g])&&"setAttribute"in u==!!j&&(j?u.localName==j:u.nodeType==3)){t=u,i[g]=null;break}}if(t==null){if(j==null)return document.createTextNode(A);t=document.createElementNS(o,j,A.is&&A),p&&(q.__m&&q.__m(n,i),p=!1),i=null}if(j==null)k===A||p&&t.data==A||(t.data=A);else{if(i=i&&Re.call(t.childNodes),k=r.props||Ie,!p&&i!=null)for(k={},g=0;g<t.attributes.length;g++)k[(u=t.attributes[g]).name]=u.value;for(g in k)if(u=k[g],g!="children"){if(g=="dangerouslySetInnerHTML")c=u;else if(!(g in A)){if(g=="value"&&"defaultValue"in A||g=="checked"&&"defaultChecked"in A)continue;qe(t,g,null,u,o)}}for(g in A)u=A[g],g=="children"?_=u:g=="dangerouslySetInnerHTML"?$=u:g=="value"?b=u:g=="checked"?T=u:p&&typeof u!="function"||k[g]===u||qe(t,g,u,k[g],o);if($)p||c&&($.__html==c.__html||$.__html==t.innerHTML)||(t.innerHTML=$.__html),n.__k=[];else if(c&&(t.innerHTML=""),Zt(n.type=="template"?t.content:t,Pe(_)?_:[_],n,r,a,j=="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,d,i?i[0]:r.__k&&Te(r,0),p,x),i!=null)for(g=i.length;g--;)ct(i[g]);p||(g="value",j=="progress"&&b==null?t.removeAttribute("value"):b!=null&&(b!==t[g]||j=="progress"&&!b||j=="option"&&b!=k[g])&&qe(t,g,b,k[g],o),g="checked",T!=null&&T!=t[g]&&qe(t,g,T,k[g],o))}return t}function ut(t,n,r){try{if(typeof t=="function"){var a=typeof t.__u=="function";a&&t.__u(),a&&n==null||(t.__u=t(n))}else t.current=n}catch(o){q.__e(o,r)}}function tn(t,n,r){var a,o;if(q.unmount&&q.unmount(t),(a=t.ref)&&(a.current&&a.current!=t.__e||ut(a,null,n)),(a=t.__c)!=null){if(a.componentWillUnmount)try{a.componentWillUnmount()}catch(i){q.__e(i,n)}a.base=a.__P=null}if(a=t.__k)for(o=0;o<a.length;o++)a[o]&&tn(a[o],n,r||typeof t.type!="function");r||ct(t.__e),t.__c=t.__=t.__e=void 0}function Nn(t,n,r){return this.constructor(t,r)}function On(t,n,r){var a,o,i,d;n==document&&(n=document.documentElement),q.__&&q.__(t,n),o=(a=!1)?null:n.__k,i=[],d=[],dt(n,t=n.__k=Ue(Ve,null,[t]),o||Ie,Ie,n.namespaceURI,o?null:n.firstChild?Re.call(n.childNodes):null,i,o?o.__e:n.firstChild,a,d),Yt(i,t,d)}function In(t,n,r){var a,o,i,d,p=ge({},t.props);for(i in t.type&&t.type.defaultProps&&(d=t.type.defaultProps),n)i=="key"?a=n[i]:i=="ref"?o=n[i]:p[i]=n[i]===void 0&&d!=null?d[i]:n[i];return arguments.length>2&&(p.children=arguments.length>3?Re.call(arguments,2):r),De(t.type,p,a||t.key,o||t.ref,null)}function Rn(t){function n(r){var a,o;return this.getChildContext||(a=new Set,(o={})[n.__c]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){a=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&a.forEach(function(d){d.__e=!0,rt(d)})},this.sub=function(i){a.add(i);var d=i.componentWillUnmount;i.componentWillUnmount=function(){a&&a.delete(i),d&&d.call(i)}}),r.children}return n.__c="__cC"+Jt++,n.__=t,n.Provider=n.__l=(n.Consumer=function(r,a){return r.children(a)}).contextType=n,n}Re=Gt.slice,q={__e:function(t,n,r,a){for(var o,i,d;n=n.__;)if((o=n.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(t)),d=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,a||{}),d=o.__d),d)return o.__E=o}catch(p){t=p}throw t}},Bt=0,Ne.prototype.setState=function(t,n){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ge({},this.state),typeof t=="function"&&(t=t(ge({},r),this.props)),t&&ge(r,t),t!=null&&this.__v&&(n&&this._sb.push(n),rt(this))},Ne.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),rt(this))},Ne.prototype.render=Ve,ve=[],Ht=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Vt=function(t,n){return t.__v.__b-n.__v.__b},Be.__r=0,Wt=/(PointerCapture)$|Capture$/i,lt=0,tt=Dt(!1),nt=Dt(!0),Jt=0;var Pn=0;function e(t,n,r,a,o,i){n||(n={});var d,p,x=n;if("ref"in x)for(p in x={},n)p=="ref"?d=n[p]:x[p]=n[p];var g={type:t,props:x,key:r,ref:d,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Pn,__i:-1,__u:0,__source:o,__self:i};if(typeof t=="function"&&(d=t.defaultProps))for(p in d)x[p]===void 0&&(x[p]=d[p]);return q.vnode&&q.vnode(g),g}var Se,J,Qe,Nt,He=0,nn=[],Y=q,Ot=Y.__b,It=Y.__r,Rt=Y.diffed,Pt=Y.__c,Ut=Y.unmount,Mt=Y.__;function We(t,n){Y.__h&&Y.__h(J,t,He||n),He=0;var r=J.__H||(J.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function y(t){return He=1,Un(sn,t)}function Un(t,n,r){var a=We(Se++,2);if(a.t=t,!a.__c&&(a.__=[sn(void 0,n),function(p){var x=a.__N?a.__N[0]:a.__[0],g=a.t(x,p);x!==g&&(a.__N=[g,a.__[1]],a.__c.setState({}))}],a.__c=J,!J.__f)){var o=function(p,x,g){if(!a.__c.__H)return!0;var $=a.__c.__H.__.filter(function(_){return!!_.__c});if($.every(function(_){return!_.__N}))return!i||i.call(this,p,x,g);var c=a.__c.props!==p;return $.forEach(function(_){if(_.__N){var u=_.__[0];_.__=_.__N,_.__N=void 0,u!==_.__[0]&&(c=!0)}}),i&&i.call(this,p,x,g)||c};J.__f=!0;var i=J.shouldComponentUpdate,d=J.componentWillUpdate;J.componentWillUpdate=function(p,x,g){if(this.__e){var $=i;i=void 0,o(p,x,g),i=$}d&&d.call(this,p,x,g)},J.shouldComponentUpdate=o}return a.__N||a.__}function he(t,n){var r=We(Se++,3);!Y.__s&&rn(r.__H,n)&&(r.__=t,r.u=n,J.__H.__h.push(r))}function Kt(t){return He=5,Mn(function(){return{current:t}},[])}function Mn(t,n){var r=We(Se++,7);return rn(r.__H,n)&&(r.__=t(),r.__H=n,r.__h=t),r.__}function Kn(t){var n=J.context[t.__c],r=We(Se++,9);return r.c=t,n?(r.__==null&&(r.__=!0,n.sub(J)),n.props.value):t.__}function qn(){for(var t;t=nn.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(ze),t.__H.__h.forEach(at),t.__H.__h=[]}catch(n){t.__H.__h=[],Y.__e(n,t.__v)}}Y.__b=function(t){J=null,Ot&&Ot(t)},Y.__=function(t,n){t&&n.__k&&n.__k.__m&&(t.__m=n.__k.__m),Mt&&Mt(t,n)},Y.__r=function(t){It&&It(t),Se=0;var n=(J=t.__c).__H;n&&(Qe===J?(n.__h=[],J.__h=[],n.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(n.__h.forEach(ze),n.__h.forEach(at),n.__h=[],Se=0)),Qe=J},Y.diffed=function(t){Rt&&Rt(t);var n=t.__c;n&&n.__H&&(n.__H.__h.length&&(nn.push(n)!==1&&Nt===Y.requestAnimationFrame||((Nt=Y.requestAnimationFrame)||zn)(qn)),n.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),Qe=J=null},Y.__c=function(t,n){n.some(function(r){try{r.__h.forEach(ze),r.__h=r.__h.filter(function(a){return!a.__||at(a)})}catch(a){n.some(function(o){o.__h&&(o.__h=[])}),n=[],Y.__e(a,r.__v)}}),Pt&&Pt(t,n)},Y.unmount=function(t){Ut&&Ut(t);var n,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(a){try{ze(a)}catch(o){n=o}}),r.__H=void 0,n&&Y.__e(n,r.__v))};var qt=typeof requestAnimationFrame=="function";function zn(t){var n,r=function(){clearTimeout(a),qt&&cancelAnimationFrame(n),setTimeout(t)},a=setTimeout(r,35);qt&&(n=requestAnimationFrame(r))}function ze(t){var n=J,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),J=n}function at(t){var n=J;t.__c=t.__(),J=n}function rn(t,n){return!t||t.length!==n.length||n.some(function(r,a){return r!==t[a]})}function sn(t,n){return typeof n=="function"?n(t):n}var Bn={};function Le(t,n){for(var r in n)t[r]=n[r];return t}function ot(t,n,r){var a,o=/(?:\?([^#]*))?(#.*)?$/,i=t.match(o),d={};if(i&&i[1])for(var p=i[1].split("&"),x=0;x<p.length;x++){var g=p[x].split("=");d[decodeURIComponent(g[0])]=decodeURIComponent(g.slice(1).join("="))}t=it(t.replace(o,"")),n=it(n||"");for(var $=Math.max(t.length,n.length),c=0;c<$;c++)if(n[c]&&n[c].charAt(0)===":"){var _=n[c].replace(/(^:|[+*?]+$)/g,""),u=(n[c].match(/[+*?]+$/)||Bn)[0]||"",b=~u.indexOf("+"),T=~u.indexOf("*"),k=t[c]||"";if(!k&&!T&&(u.indexOf("?")<0||b)){a=!1;break}if(d[_]=decodeURIComponent(k),b||T){d[_]=t.slice(c).map(decodeURIComponent).join("/");break}}else if(n[c]!==t[c]){a=!1;break}return(r.default===!0||a!==!1)&&d}function Hn(t,n){return t.rank<n.rank?1:t.rank>n.rank?-1:t.index-n.index}function Vn(t,n){return t.index=n,t.rank=function(r){return r.props.default?0:it(r.props.path).map(Wn).join("")}(t),t.props}function it(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function Wn(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var Jn={},we=[],Oe=[],ue=null,ht={url:mt()},an=Rn(ht);function Gn(){var t=Kn(an);if(t===ht){var n=y()[1];he(function(){return Oe.push(n),function(){return Oe.splice(Oe.indexOf(n),1)}},[])}return[t,on]}function mt(){var t;return""+((t=ue&&ue.location?ue.location:ue&&ue.getCurrentLocation?ue.getCurrentLocation():typeof location<"u"?location:Jn).pathname||"")+(t.search||"")}function on(t,n){return n===void 0&&(n=!1),typeof t!="string"&&t.url&&(n=t.replace,t=t.url),function(r){for(var a=we.length;a--;)if(we[a].canRoute(r))return!0;return!1}(t)&&function(r,a){a===void 0&&(a="push"),ue&&ue[a]?ue[a](r):typeof history<"u"&&history[a+"State"]&&history[a+"State"](null,null,r)}(t,n?"replace":"push"),ln(t)}function ln(t){for(var n=!1,r=0;r<we.length;r++)we[r].routeTo(t)&&(n=!0);return n}function Qn(t){if(t&&t.getAttribute){var n=t.getAttribute("href"),r=t.getAttribute("target");if(n&&n.match(/^\//g)&&(!r||r.match(/^_?self$/i)))return on(n)}}function Zn(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function cn(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var n=t.target;do if(n.localName==="a"&&n.getAttribute("href")){if(n.hasAttribute("data-native")||n.hasAttribute("native"))return;if(Qn(n))return Zn(t)}while(n=n.parentNode)}}var zt=!1;function dn(t){t.history&&(ue=t.history),this.state={url:t.url||mt()}}Le(dn.prototype=new Ne,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var n=st(this.props.children);return this.g(n,t)!==void 0},routeTo:function(t){this.setState({url:t});var n=this.canRoute(t);return this.p||this.forceUpdate(),n},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;zt||(zt=!0,ue||addEventListener("popstate",function(){ln(mt())}),addEventListener("click",cn)),we.push(this),ue&&(this.u=ue.listen(function(n){var r=n.location||n;t.routeTo(""+(r.pathname||"")+(r.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),we.splice(we.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,n){t=t.filter(Vn).sort(Hn);for(var r=0;r<t.length;r++){var a=t[r],o=ot(n,a.props.path,a.props);if(o)return[a,o]}},render:function(t,n){var r,a,o=t.onChange,i=n.url,d=this.c,p=this.g(st(t.children),i);if(p&&(a=In(p[0],Le(Le({url:i,matches:r=p[1]},r),{key:void 0,ref:void 0}))),i!==(d&&d.url)){Le(ht,d=this.c={url:i,previous:d&&d.url,current:a,path:a?a.props.path:null,matches:r}),d.router=this,d.active=a?[a]:[];for(var x=Oe.length;x--;)Oe[x]({});typeof o=="function"&&o(d)}return Ue(an.Provider,{value:d},a)}});var Xn=function(t){return Ue("a",Le({onClick:cn},t))},Ce=function(t){return Ue(t.component,t)},Yn=["className","activeClass","activeClassName","path"];function er(t){var n=t.className,r=t.activeClass,a=t.activeClassName,o=t.path,i=function($,c){if($==null)return{};var _,u,b={},T=Object.keys($);for(u=0;u<T.length;u++)c.indexOf(_=T[u])>=0||(b[_]=$[_]);return b}(t,Yn),d=Gn()[0],p=o&&d.path&&ot(d.path,o,{})||ot(d.url,i.href,{}),x=i.class||n||"",g=p&&(r||a)||"";return i.class=x+(x&&g&&" ")+g,Ue(Xn,i)}function un(t){var n,r,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(n=0;n<o;n++)t[n]&&(r=un(t[n]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r);return a}function tr(){for(var t,n,r=0,a="",o=arguments.length;r<o;r++)(t=arguments[r])&&(n=un(t))&&(a&&(a+=" "),a+=n);return a}function nr({children:t}){return e("div",{class:"min-h-screen bg-gray-50",children:[e("nav",{class:"bg-white shadow-sm border-b",children:e("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e("div",{class:"flex justify-between h-16",children:[e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0 flex items-center",children:e("h1",{class:"text-xl font-bold text-gray-900",children:"Vibebase"})}),e("div",{class:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[e(Ee,{href:"/",children:"Dashboard"}),e(Ee,{href:"/database",children:"Database"}),e(Ee,{href:"/custom-sql",children:"Custom SQL"}),e(Ee,{href:"/storage",children:"Storage"}),e(Ee,{href:"/auth",children:"Auth"}),e(Ee,{href:"/settings",children:"Settings"})]})]}),e("div",{class:"flex items-center space-x-4",children:e("a",{href:"/api/docs/swagger",target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"📚 API Docs"})})]})})}),e("main",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:t})]})}function Ee({href:t,children:n}){return e(er,{href:t,class:tr("inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium","hover:border-gray-300 hover:text-gray-700","border-transparent text-gray-500"),activeClassName:"border-indigo-500 text-gray-900",children:n})}const I=window.location.origin,U={async health(){return(await fetch(`${I}/api/health`)).json()},async getItems(){const t=await fetch(`${I}/api/items`);if(!t.ok)throw new Error("Failed to fetch items");return t.json()},async createItem(t){const n=await fetch(`${I}/api/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error("Failed to create item");return n.json()},async updateItem(t,n){const r=await fetch(`${I}/api/items/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok)throw new Error("Failed to update item");return r.json()},async deleteItem(t){const n=await fetch(`${I}/api/items/${t}`,{method:"DELETE"});if(!n.ok)throw new Error("Failed to delete item");return n.json()},async getTables(){const t=await fetch(`${I}/api/tables`);if(!t.ok)throw new Error("Failed to fetch tables");return t.json()},async getTableSchema(t){const n=await fetch(`${I}/api/tables/${t}/schema`);if(!n.ok)throw new Error("Failed to fetch table schema");return n.json()},async getTableData(t,n=100,r=0){const a=await fetch(`${I}/api/tables/${t}/data?limit=${n}&offset=${r}`);if(!a.ok)throw new Error("Failed to fetch table data");return a.json()},async createTable(t,n){const r=await fetch(`${I}/api/tables`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,columns:n})});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to create table")}return r.json()},async dropTable(t){const n=await fetch(`${I}/api/tables/${t}`,{method:"DELETE"});if(!n.ok){const r=await n.json();throw new Error(r.error||"Failed to drop table")}return n.json()},async executeSQL(t,n=[]){const r=await fetch(`${I}/api/tables/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:t,params:n})});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to execute SQL")}return r.json()},async addColumn(t,n){const r=await fetch(`${I}/api/tables/${t}/columns`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to add column")}return r.json()},async renameColumn(t,n,r){const a=await fetch(`${I}/api/tables/${t}/columns/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldName:n,newName:r})});if(!a.ok){const o=await a.json();throw new Error(o.error||"Failed to rename column")}return a.json()},async dropColumn(t,n){const r=await fetch(`${I}/api/tables/${t}/columns/${n}`,{method:"DELETE"});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to drop column")}return r.json()},async modifyColumn(t,n,r){const a=await fetch(`${I}/api/tables/${t}/columns/${n}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const o=await a.json();throw new Error(o.error||"Failed to modify column")}return a.json()},async validateColumnChanges(t,n,r){const a=await fetch(`${I}/api/tables/${t}/columns/${n}/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const o=await a.json();throw new Error(o.error||"Failed to validate column changes")}return a.json()},async updateRecord(t,n,r){const a=await fetch(`${I}/api/tables/${t}/data/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const o=await a.json();throw new Error(o.error||"Failed to update record")}return a.json()},async getSnapshots(t=20,n=0){const r=await fetch(`${I}/api/snapshots?limit=${t}&offset=${n}`);if(!r.ok)throw new Error("Failed to fetch snapshots");return r.json()},async getSnapshot(t){const n=await fetch(`${I}/api/snapshots/${t}`);if(!n.ok)throw new Error("Failed to fetch snapshot");return n.json()},async createSnapshot(t){const n=await fetch(`${I}/api/snapshots`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const r=await n.json();throw new Error(r.error||"Failed to create snapshot")}return n.json()},async restoreSnapshot(t){const n=await fetch(`${I}/api/snapshots/${t}/restore`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!n.ok){const r=await n.json().catch(()=>({error:"Failed to restore snapshot"}));throw new Error(r.error||"Failed to restore snapshot")}return n.json()},async deleteSnapshot(t){const n=await fetch(`${I}/api/snapshots/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!n.ok){const r=await n.json().catch(()=>({error:"Failed to delete snapshot"}));throw new Error(r.error||"Failed to delete snapshot")}return n.json()},async compareSnapshots(t,n){const r=await fetch(`${I}/api/snapshots/compare/${t}/${n}`);if(!r.ok)throw new Error("Failed to compare snapshots");return r.json()},async getTableIndexes(t){const n=await fetch(`${I}/api/tables/${t}/indexes`);if(!n.ok){const r=await n.json();throw new Error(r.error||"Failed to fetch table indexes")}return n.json()},async getAllIndexes(){const t=await fetch(`${I}/api/tables/indexes`);if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to fetch all indexes")}return t.json()},async createIndex(t,n){const r=await fetch(`${I}/api/tables/${t}/indexes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to create index")}return r.json()},async dropIndex(t,n){const r=await fetch(`${I}/api/tables/${t}/indexes/${n}`,{method:"DELETE"});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to drop index")}return r.json()},async getOAuthProviders(){const t=await fetch(`${I}/api/admin/oauth/providers`);if(!t.ok){let n="Failed to fetch OAuth providers";try{const r=await t.json();r.error==="Authentication required"?n="Admin authentication required. Please log in to access OAuth settings.":n=r.error||n}catch{}throw new Error(n)}return t.json()},async getOAuthProvider(t){const n=await fetch(`${I}/api/admin/oauth/providers/${t}`);if(!n.ok){const r=await n.json();throw new Error(r.error||"Failed to fetch OAuth provider")}return n.json()},async updateOAuthProvider(t,n){const r=await fetch(`${I}/api/admin/oauth/providers/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to update OAuth provider")}return r.json()},async toggleOAuthProvider(t,n){const r=await fetch(`${I}/api/admin/oauth/providers/${t}/toggle`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_enabled:n})});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to toggle OAuth provider")}return r.json()},async deleteOAuthProvider(t){const n=await fetch(`${I}/api/admin/oauth/providers/${t}`,{method:"DELETE"});if(!n.ok){const r=await n.json();throw new Error(r.error||"Failed to delete OAuth provider")}return n.json()},async getSupportedProviders(){const t=await fetch(`${I}/api/admin/oauth/supported-providers`);if(!t.ok){let n="Failed to fetch supported providers";try{const r=await t.json();r.error==="Authentication required"?n="Admin authentication required. Please log in to access OAuth settings.":n=r.error||n}catch{}throw new Error(n)}return t.json()},async getTablePolicy(t){const n=await fetch(`${I}/api/tables/${t}/policy`);if(!n.ok){const r=await n.json();throw new Error(r.error||"Failed to get table policy")}return n.json()},async updateTablePolicy(t,n){const r=await fetch(`${I}/api/tables/${t}/policy`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_policy:n})});if(!r.ok){const a=await r.json();throw new Error(a.error||"Failed to update table policy")}return r.json()}};function rr(){const[t,n]=y({userTables:0,systemTables:0,dbStatus:"checking..."});he(()=>{r()},[]);const r=async()=>{try{const a=await U.health(),o=await U.getTables(),i=o.tables.filter(p=>p.type==="user").length,d=o.tables.filter(p=>p.type==="system").length;n({userTables:i,systemTables:d,dbStatus:a.database==="connected"?"connected":"disconnected"})}catch(a){console.error("Failed to load stats:",a),n(o=>({...o,dbStatus:"error"}))}};return e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Dashboard"}),e("div",{class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:[e(Ze,{title:"Database Tables",description:"User-defined tables in D1",href:"/database",stats:`${t.userTables} tables`,status:t.dbStatus}),e(Ze,{title:"System Tables",description:"Protected system tables",href:"/database",stats:`${t.systemTables} tables`}),e(Ze,{title:"Storage",description:"R2 object storage for files",href:"/storage",stats:"Ready",status:"connected"})]}),e("div",{class:"mt-8",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:e("div",{class:"space-y-3",children:[e("a",{href:"/database",class:"text-indigo-600 hover:text-indigo-500 block",children:"Create new table →"}),e("a",{href:"/database",class:"text-indigo-600 hover:text-indigo-500 block",children:"Browse database →"}),e("a",{href:"/storage",class:"text-indigo-600 hover:text-indigo-500 block",children:"Upload files →"}),e("a",{href:"/api/health",target:"_blank",class:"text-indigo-600 hover:text-indigo-500 block",children:"View API health →"})]})})})]}),e("div",{class:"mt-8",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"API Endpoints"}),e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:e("div",{class:"space-y-2 text-sm",children:[e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/health"}),e("span",{class:"text-green-600",children:"Health check"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/tables"}),e("span",{class:"text-green-600",children:"List tables"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"POST /api/tables"}),e("span",{class:"text-green-600",children:"Create table"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/tables/:name/data"}),e("span",{class:"text-green-600",children:"Get table data"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"GET /api/storage"}),e("span",{class:"text-green-600",children:"List files"})]}),e("div",{class:"flex justify-between",children:[e("code",{class:"text-gray-600",children:"POST /api/storage/upload"}),e("span",{class:"text-green-600",children:"Upload file"})]})]})})})]})]})}function Ze({title:t,description:n,href:r,stats:a,status:o}){return e("div",{class:"bg-white overflow-hidden shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex items-center justify-between",children:[e("dt",{class:"text-sm font-medium text-gray-500 truncate",children:t}),o&&e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o==="connected"?"bg-green-100 text-green-800":o==="error"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:o})]}),e("dd",{class:"mt-1 text-3xl font-semibold text-gray-900",children:a}),e("p",{class:"mt-2 text-sm text-gray-600",children:n}),e("a",{href:r,class:"mt-3 text-indigo-600 hover:text-indigo-500 text-sm font-medium inline-block",children:"Manage →"})]})})}function Xe({size:t="sm"}){return e("svg",{class:`animate-spin ${t==="sm"?"h-4 w-4":"h-6 w-6"} text-white`,fill:"none",viewBox:"0 0 24 24",children:[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}function sr({onClose:t,onRestore:n}){const[r,a]=y([]),[o,i]=y(null),[d,p]=y(!0),[x,g]=y(null),[$,c]=y(!1),[_,u]=y({name:"",description:""}),[b,T]=y(null),[k,A]=y(null),[j,F]=y(null),[E,R]=y(!1),[M,te]=y(!1),[W,ne]=y(!1);he(()=>{le()},[]),he(()=>{const C=P=>{if(j){const oe=P.target;!oe.closest("[data-menu-container]")&&!oe.closest("[data-menu-button]")&&F(null)}};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[j]);const le=async()=>{try{p(!0),g(null);const C=await U.getSnapshots();a(C.snapshots)}catch(C){g(C instanceof Error?C.message:"Failed to load data")}finally{p(!1)}},G=async C=>{C.preventDefault();try{g(null),R(!0),await U.createSnapshot(_),c(!1),u({name:"",description:""}),await le()}catch(P){g(P instanceof Error?P.message:"Failed to create snapshot")}finally{R(!1)}},O=async()=>{if(b)try{g(null),te(!0),await U.restoreSnapshot(b),T(null),n&&n(),t()}catch(C){g(C instanceof Error?C.message:"Failed to restore"),T(null)}finally{te(!1)}},de=async()=>{if(k)try{g(null),ne(!0),await U.deleteSnapshot(k),A(null),F(null),await le()}catch(C){g(C instanceof Error?C.message:"Failed to delete snapshot"),A(null)}finally{ne(!1)}},Q=C=>new Date(C).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZoneName:"short"}),pe=C=>{const P=new Date(C),ee=new Date().getTime()-P.getTime(),re=Math.floor(ee/(1e3*60*60*24)),h=Math.floor(ee%(1e3*60*60*24)/(1e3*60*60));return re>0?`${re} day${re>1?"s":""} ago`:h>0?`${h} hour${h>1?"s":""} ago`:"Just now"};return e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg w-full max-w-6xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[e("div",{class:"px-6 py-4 border-b flex items-center justify-between",children:[e("h2",{class:"text-xl font-semibold text-gray-900",children:"Schema Snapshots"}),e("button",{onClick:t,class:"text-gray-400 hover:text-gray-600",children:e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})})})]}),x&&e("div",{class:"mx-6 mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:e("div",{class:"text-sm text-red-700",children:x})}),e("div",{class:"mx-6 mt-4 bg-blue-50 border border-blue-200 rounded-md p-4",children:e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})})}),e("div",{class:"ml-3",children:[e("h3",{class:"text-sm font-medium text-blue-800",children:"💡 CloudflareのTime Travel機能について"}),e("p",{class:"mt-1 text-sm text-blue-700",children:["Cloudflareの管理画面から、D1データベースを過去の任意の時点（無料プランで7日間、有料プランで30日間）に復元できるTime Travel機能が利用可能です。 詳しくは",e("a",{href:"https://developers.cloudflare.com/d1/reference/time-travel/",target:"_blank",rel:"noopener noreferrer",class:"font-medium underline hover:no-underline",children:"Cloudflare D1 Time Travelドキュメント"}),"をご確認ください。"]})]})]})}),e("div",{class:"flex-1 overflow-auto p-6",children:d?e("div",{class:"text-center py-8",children:e("div",{class:"text-gray-500",children:"Loading..."})}):e("div",{children:[!$&&e("div",{class:"mb-6",children:e("button",{onClick:()=>c(!0),class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e("svg",{class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})}),"Create Snapshot"]})}),$&&e("div",{class:"mb-6 bg-gray-50 rounded-lg p-4",children:[e("h3",{class:"text-sm font-medium text-gray-900 mb-3",children:"Create New Snapshot"}),e("form",{onSubmit:G,children:e("div",{class:"space-y-3",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Name"}),e("input",{type:"text",value:_.name,onInput:C=>u({..._,name:C.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"e.g., Before major refactoring"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Description"}),e("textarea",{value:_.description,onInput:C=>u({..._,description:C.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",rows:2,placeholder:"Optional description of current state"})]}),e("div",{class:"flex space-x-3",children:[e("button",{type:"submit",disabled:E,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${E?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:[E&&e(Xe,{size:"sm"}),e("span",{children:E?"Creating...":"Create"})]}),e("button",{type:"button",onClick:()=>{c(!1),u({name:"",description:""})},class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})})]}),e("div",{class:"space-y-3",children:r.length===0?e("div",{class:"text-center py-8 text-gray-500",children:"No snapshots yet. Create your first snapshot to start tracking schema changes."}):r.map(C=>e("div",{class:`border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer ${(o==null?void 0:o.id)===C.id?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,onClick:()=>i(C),children:e("div",{class:"flex items-start justify-between",children:[e("div",{class:"flex-1",children:[e("div",{class:"flex items-center space-x-3",children:[e("h4",{class:"text-sm font-medium text-gray-900",children:C.name||`Snapshot v${C.version}`}),e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C.snapshotType==="manual"?"bg-blue-100 text-blue-800":C.snapshotType==="auto"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:C.snapshotType})]}),C.description&&e("p",{class:"mt-1 text-sm text-gray-600",children:C.description}),e("div",{class:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[e("span",{children:["Version ",C.version]}),e("span",{children:Q(C.createdAt)}),e("span",{children:pe(C.createdAt)})]})]}),e("div",{class:"ml-4 flex items-center space-x-2",children:[e("button",{onClick:P=>{P.stopPropagation(),T(C.id)},class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Restore"}),e("div",{class:"relative",children:[e("button",{onClick:P=>{P.stopPropagation(),F(j===C.id?null:C.id)},"data-menu-button":"true",class:"inline-flex items-center p-1.5 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 rounded-md",children:e("svg",{class:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),j===C.id&&e("div",{class:"absolute right-0 top-full mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10","data-menu-container":"true",children:e("div",{class:"py-1",children:e("button",{onClick:P=>{P.preventDefault(),P.stopPropagation(),F(null),A(C.id)},class:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 focus:outline-none",children:e("div",{class:"flex items-center space-x-2",children:[e("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e("span",{children:"Delete"})]})})})})]})]})]})},C.id))})]})}),b&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Confirm Restore"})})]}),e("div",{class:"mb-6",children:[e("p",{class:"text-sm text-gray-700",children:"This will restore your database schema to the selected snapshot. All current tables and data will be replaced."}),e("p",{class:"text-sm text-red-600 mt-2 font-medium",children:"This action cannot be undone. Make sure you have a backup of your current data."})]}),e("div",{class:"flex space-x-3",children:[e("button",{onClick:O,disabled:M,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${M?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:[M&&e(Xe,{size:"sm"}),e("span",{children:M?"Restoring...":"Restore"})]}),e("button",{onClick:()=>T(null),disabled:M,class:`inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${M?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-gray-700 bg-white hover:bg-gray-50"}`,children:"Cancel"})]})]})}),k&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Delete Snapshot"})})]}),e("div",{class:"mb-6",children:e("p",{class:"text-sm text-gray-700",children:"Are you sure you want to delete this snapshot? This action cannot be undone."})}),e("div",{class:"flex space-x-3",children:[e("button",{onClick:de,disabled:W,class:`inline-flex justify-center items-center space-x-2 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ${W?"bg-red-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,children:[W&&e(Xe,{size:"sm"}),e("span",{children:W?"Deleting...":"Delete"})]}),e("button",{onClick:()=>A(null),disabled:W,class:`inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${W?"text-gray-400 bg-gray-100 cursor-not-allowed":"text-gray-700 bg-white hover:bg-gray-50"}`,children:"Cancel"})]})]})})]})})}const ar=t=>t?t.length>8?`${t.substring(0,4)}...`:t:"-",or=["admins","sessions","schema_snapshots","schema_snapshot_counter","d1_migrations","api_keys","user_sessions","oauth_providers","app_settings","table_policies"],Ye=t=>t.filter(n=>!or.includes(n.name)),et=(t,n)=>{const r=n.filter(a=>a.trim()!=="").join("_");return`idx_${t}_${r}`.toLowerCase()},ir=async t=>{try{return await navigator.clipboard.writeText(t),!0}catch{try{const r=document.createElement("textarea");r.value=t,document.body.appendChild(r),r.focus(),r.select();const a=document.execCommand("copy");return document.body.removeChild(r),a}catch(r){return console.error("Failed to copy to clipboard:",r),!1}}};function lr(){var wt,_t,kt,Ct,Et;const[t,n]=y([]),[r,a]=y(null),[o,i]=y([]),[d,p]=y([]),[x,g]=y([]),[$,c]=y(!1),[_,u]=y(null),[b,T]=y(!1),[k,A]=y(!1),[j,F]=y({}),[E,R]=y({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),[M,te]=y(null),[W,ne]=y(null),[le,G]=y(!1),[O,de]=y({name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}),[Q,pe]=y(null),[C,P]=y(null),[oe,ee]=y(null),[re,h]=y(null),[v,D]=y(null),[N,K]=y(null),[se,fe]=y({}),[ae,$e]=y({}),Je=Kt(null),Ae=Kt(!1),[Ge,Me]=y(!1),[w,S]=y([]),[X,ie]=y(!1),[Z,xe]=y({name:"",columns:[""],unique:!1}),[pt,ft]=y(null);he(()=>{if(r&&Z.columns.some(s=>s.trim()!=="")){const s=et(r,Z.columns);xe(l=>({...l,name:s}))}},[r,Z.columns]);const gt=s=>s?new Date(s).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZoneName:"short"}):"-";he(()=>{Ke()},[]),he(()=>{r&&(_e(),be(),T(!1),A(!1),G(!1))},[r]),he(()=>{const s=()=>{te(null)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const Ke=async()=>{try{c(!0);const s=await U.getTables();n(s.tables),u(null)}catch(s){u(s instanceof Error?s.message:"Failed to load tables")}finally{c(!1)}},be=async()=>{if(r)try{const s=await U.getTableSchema(r);p(s.columns),g(s.foreignKeys||[]);const l=await U.getTableIndexes(r);S(l.indexes);const f={};s.columns.forEach(m=>{["id","created_at","updated_at"].includes(m.name)||(f[m.name]="")}),F(f)}catch(s){console.error("Failed to load table schema:",s)}},_e=async()=>{if(r)try{c(!0);const s=await U.getTableData(r);i(s.data),u(null)}catch(s){u(s instanceof Error?s.message:"Failed to load table data")}finally{c(!1)}},hn=async s=>{if(s.preventDefault(),!!r)try{const l=Object.fromEntries(Object.entries(j).map(([m,L])=>[m,L===""?null:L]));console.log("Sending record data:",l);const f=await fetch(`${window.location.origin}/api/tables/${r}/data`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!f.ok){const m=await f.json();throw new Error(m.error||`HTTP ${f.status}: Failed to create record`)}await _e(),T(!1),u(null)}catch(l){if(console.error("Create record error:",l),l instanceof Error){let f=l.message;if(l.message.includes("FOREIGN KEY constraint failed"))f="Foreign key constraint failed: The referenced record does not exist";else if(l.message.includes("NOT NULL constraint failed")){const m=l.message.match(/NOT NULL constraint failed: (\w+)\.(\w+)/);m?f=`Required field "${m[2]}" cannot be empty`:f="A required field cannot be empty"}else if(l.message.includes("UNIQUE constraint failed")){const m=l.message.match(/UNIQUE constraint failed: (\w+)\.(\w+)/);m?f=`Value for "${m[2]}" must be unique`:f="This value must be unique"}u(f)}else u("Failed to create record")}},mn=async s=>{r&&h({title:"Delete Record",message:"Are you sure you want to delete this record? This action cannot be undone.",variant:"danger",onConfirm:async()=>{h(null);try{await fetch(`${window.location.origin}/api/tables/${r}/data/${s}`,{method:"DELETE"}),await _e()}catch(l){u(l instanceof Error?l.message:"Failed to delete record")}}})},pn=async s=>{s.preventDefault();try{const l=E.columns.filter(f=>f.name).map(f=>{var m,L,B;return{name:f.name,type:f.type,constraints:f.notNull?"NOT NULL":void 0,...(m=f.foreignKey)!=null&&m.enabled&&((L=f.foreignKey)!=null&&L.table)&&((B=f.foreignKey)!=null&&B.column)?{foreignKey:{table:f.foreignKey.table,column:f.foreignKey.column}}:{}}});console.log("Creating table:",E.name,"with columns:",l),await U.createTable(E.name,l);for(const f of E.indexes)if(f.name&&f.columns.length>0&&f.columns.some(m=>m.trim()!==""))try{await U.createIndex(E.name,{name:f.name,columns:f.columns.filter(m=>m.trim()!==""),unique:f.unique})}catch(m){console.warn("Failed to create index:",m)}await Ke(),A(!1),R({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),u(null)}catch(l){u(l instanceof Error?l.message:"Failed to create table")}},fn=async s=>{h({title:"Drop Table",message:`Are you sure you want to drop the table "${s}"? This action cannot be undone.`,variant:"danger",onConfirm:async()=>{h(null);try{await U.dropTable(s),await Ke(),r===s&&(a(null),i([]))}catch(l){u(l instanceof Error?l.message:"Failed to drop table")}}})},gn=async(s,l)=>{try{ft(s),await U.updateTablePolicy(s,l),n(f=>f.map(m=>m.name===s?{...m,access_policy:l}:m)),u(null)}catch(f){u(f instanceof Error?f.message:"Failed to update table policy")}finally{ft(null)}},bn=async(s,l,f)=>{if(await ir(s)){const L=`${l}-${f}`;ne(L),setTimeout(()=>ne(null),2e3)}},xn=async(s,l,f,m)=>{s.metaKey||s.ctrlKey?await yn(l,m):await bn(l,f,m)},yn=async(s,l)=>{const f=await vn(s,l);f&&(a(f),setTimeout(()=>{const m=document.querySelector(`[data-record-id="${s}"]`);m&&(m.scrollIntoView({behavior:"smooth",block:"center"}),m.classList.add("bg-yellow-100"),setTimeout(()=>m.classList.remove("bg-yellow-100"),2e3))},500))},vn=async(s,l)=>{if(l.endsWith("_id")){const f=l.replace("_id","")+"s",m=t.find(L=>L.name===f);if(m)return m.name}for(const f of t)try{if((await U.getTableData(f.name,1,0)).data.some(B=>B.id===s))return f.name}catch{}return null},wn=async s=>{var l,f,m;if(s.preventDefault(),!!r)try{const L={name:O.name,type:O.type,constraints:O.notNull?"NOT NULL":void 0,...(l=O.foreignKey)!=null&&l.enabled&&((f=O.foreignKey)!=null&&f.table)&&((m=O.foreignKey)!=null&&m.column)?{foreignKey:{table:O.foreignKey.table,column:O.foreignKey.column}}:{}};await U.addColumn(r,L),await be(),de({name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}),u(null)}catch(L){u(L instanceof Error?L.message:"Failed to add column")}},bt=async(s,l)=>{if(!(!r||!l||s===l))try{await U.renameColumn(r,s,l),await be(),pe(null),u(null)}catch(f){u(f instanceof Error?f.message:"Failed to rename column")}},_n=async s=>{r&&h({title:"Drop Column",message:`Are you sure you want to drop the column "${s}"? This action cannot be undone.`,variant:"danger",onConfirm:async()=>{h(null);try{await U.dropColumn(r,s),await be(),u(null)}catch(l){u(l instanceof Error?l.message:"Failed to drop column")}}})},kn=async(s,l)=>{if(r)try{const f=await U.validateColumnChanges(r,s,l);if(!f.valid){ee({errors:f.errors,conflictingRows:f.conflictingRows,onConfirm:async()=>{ee(null);try{await U.modifyColumn(r,s,l),await be(),P(null),u(null)}catch(m){u(m instanceof Error?m.message:"Failed to modify column")}}});return}await U.modifyColumn(r,s,l),await be(),P(null),u(null)}catch(f){u(f instanceof Error?f.message:"Failed to modify column")}},ce=s=>x.find(l=>l.from===s)||null,xt=async(s,l)=>{if(!s.trim())return null;const f=`${l.table}-${s}`;$e(m=>({...m,[f]:{isValid:!1,isChecking:!0}}));try{const L=(await U.getTableData(l.table)).data.some(B=>B.id===s);return $e(B=>({...B,[f]:{isValid:L,isChecking:!1,displayName:L?`Valid ID in ${l.table}`:`ID not found in ${l.table}`}})),L}catch{return $e(L=>({...L,[f]:{isValid:!1,isChecking:!1,displayName:`Error checking ${l.table}`}})),!1}},Cn=(s,l,f)=>{if(["id","created_at","updated_at"].includes(l))return;const m=d.find(B=>B.name===l);if(ce(l)||!m){const B=o.find(z=>z.id===s);B&&K({id:s,data:{...B}})}else Ae.current=!1,D({rowId:s,columnName:l,value:f})},yt=async(s,l,f)=>{if(r){D(null),i(m=>m.map(L=>L.id===s?{...L,[l]:f}:L));try{await U.updateRecord(r,s,{[l]:f}),u(null)}catch(m){u(m instanceof Error?m.message:"Failed to update record"),D({rowId:s,columnName:l,value:f}),await _e()}}},En=()=>{D(null)},Tn=async()=>{if(!(!r||!N))try{const s={...N.data};delete s.id,delete s.created_at,delete s.updated_at,await U.updateRecord(r,N.id,s),await _e(),K(null),u(null)}catch(s){u(s instanceof Error?s.message:"Failed to update record")}},Sn=async s=>{if(s.preventDefault(),!!r)try{const l=Z.columns.filter(f=>f.trim()!=="");if(l.length===0){u("At least one column is required for the index");return}await U.createIndex(r,{name:Z.name,columns:l,unique:Z.unique}),await be(),xe({name:"",columns:[""],unique:!1}),ie(!1),u(null)}catch(l){u(l instanceof Error?l.message:"Failed to create index")}},$n=async s=>{r&&h({title:"Drop Index",message:`Are you sure you want to drop the index "${s}"? This action cannot be undone.`,variant:"danger",onConfirm:async()=>{h(null);try{await U.dropIndex(r,s),await be(),u(null)}catch(l){u(l instanceof Error?l.message:"Failed to drop index")}}})},vt=t.filter(s=>s.type==="user"),An=t.filter(s=>s.type==="system");return e("div",{children:[e("div",{class:"sm:flex sm:items-center",children:[e("div",{class:"sm:flex-auto",children:[e("h2",{class:"text-2xl font-bold text-gray-900",children:"Database"}),e("p",{class:"mt-2 text-sm text-gray-700",children:"Manage your D1 database tables and data"})]}),e("div",{class:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none flex space-x-3",children:[e("button",{type:"button",onClick:()=>Me(!0),class:"inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto",children:[e("svg",{class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"History"]}),e("button",{type:"button",onClick:()=>A(!0),class:"inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:w-auto",children:"Create Table"})]})]}),_&&!b&&e("div",{class:"mt-4 bg-red-50 border border-red-200 rounded-md p-4",children:[e("div",{class:"text-sm text-red-700",children:_}),e("button",{onClick:()=>u(null),class:"mt-2 text-xs text-red-600 hover:text-red-500",children:"Dismiss"})]}),k&&e("div",{class:"mt-6 bg-white shadow rounded-lg p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Create New Table"}),e("form",{onSubmit:pn,children:[e("div",{class:"mb-4",children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Table Name"}),e("input",{type:"text",value:E.name,onInput:s=>R({...E,name:s.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"my_table",pattern:"[a-zA-Z_][a-zA-Z0-9_]*",required:!0})]}),e("div",{class:"mb-4",children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-2",children:"Columns"}),e("div",{class:"space-y-2",children:E.columns.map((s,l)=>{var f,m,L,B;return e("div",{children:[e("div",{class:"flex space-x-2",children:[e("input",{type:"text",value:s.name,onInput:z=>{const H=[...E.columns];H[l].name=z.target.value,R({...E,columns:H})},class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"column_name",pattern:"[a-zA-Z_][a-zA-Z0-9_]*"}),e("select",{value:s.type,onChange:z=>{const H=[...E.columns];H[l].type=z.target.value,R({...E,columns:H})},class:"border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e("option",{value:"TEXT",children:"TEXT"}),e("option",{value:"INTEGER",children:"INTEGER"}),e("option",{value:"REAL",children:"REAL"}),e("option",{value:"BLOB",children:"BLOB"}),e("option",{value:"BOOLEAN",children:"BOOLEAN"})]}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:s.notNull||!1,onChange:z=>{const H=[...E.columns];H[l].notNull=z.target.checked,R({...E,columns:H})},class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"NN"})]}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:((f=s.foreignKey)==null?void 0:f.enabled)||!1,onChange:z=>{const H=[...E.columns],ye=z.target.checked;H[l].foreignKey={...H[l].foreignKey,enabled:ye,column:ye?"id":""},R({...E,columns:H})},class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"FK"})]}),l>0&&e("button",{type:"button",onClick:()=>{const z=E.columns.filter((H,ye)=>ye!==l);R({...E,columns:z})},class:"text-red-600 hover:text-red-900 text-sm",children:"Remove"})]}),((m=s.foreignKey)==null?void 0:m.enabled)&&e("div",{class:"flex space-x-2 ml-4 mt-1",children:[e("select",{value:((L=s.foreignKey)==null?void 0:L.table)||"",onChange:z=>{const H=[...E.columns];H[l].foreignKey={...H[l].foreignKey,table:z.target.value},R({...E,columns:H})},class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e("option",{value:"",children:"Select table..."}),Ye(t).map(z=>e("option",{value:z.name,children:z.name},z.name))]}),e("input",{type:"text",value:((B=s.foreignKey)==null?void 0:B.column)||"",onChange:z=>{const H=[...E.columns];H[l].foreignKey={...H[l].foreignKey,column:z.target.value},R({...E,columns:H})},placeholder:"id",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]})]},l)})}),e("button",{type:"button",onClick:()=>R({...E,columns:[...E.columns,{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}]}),class:"mt-2 text-sm text-indigo-600 hover:text-indigo-500",children:"Add Column"}),e("p",{class:"mt-2 text-xs text-gray-500",children:"Note: id, created_at, and updated_at columns will be added automatically"})]}),e("div",{class:"mb-4",children:[e("div",{class:"flex items-center justify-between mb-2",children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Indexes (Optional)"}),e("button",{type:"button",onClick:()=>{const s=E.columns.filter(f=>f.name.trim()!=="").map(f=>f.name),l=E.name?et(E.name,s.slice(0,1)):"";R({...E,indexes:[...E.indexes,{name:l,columns:s.slice(0,1),unique:!1}]})},class:"text-sm text-indigo-600 hover:text-indigo-500",children:"Add Index"})]}),e("div",{class:"space-y-3",children:E.indexes.map((s,l)=>e("div",{class:"p-3 bg-gray-50 rounded-md",children:[e("div",{class:"flex space-x-2 mb-2",children:[e("input",{type:"text",value:s.name,onInput:f=>{const m=[...E.indexes];m[l].name=f.target.value,R({...E,indexes:m})},placeholder:"index_name",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:s.unique,onChange:f=>{const m=[...E.indexes];m[l].unique=f.target.checked,R({...E,indexes:m})},class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"Unique"})]}),e("button",{type:"button",onClick:()=>{const f=E.indexes.filter((m,L)=>L!==l);R({...E,indexes:f})},class:"text-red-600 hover:text-red-900 text-sm",children:"Remove"})]}),e("div",{class:"space-y-1",children:[e("label",{class:"text-xs text-gray-700",children:"Columns:"}),s.columns.map((f,m)=>e("div",{class:"flex space-x-2",children:[e("select",{value:f,onChange:L=>{const B=[...E.indexes];B[l].columns[m]=L.target.value,E.name&&(B[l].name=et(E.name,B[l].columns.filter(z=>z.trim()!==""))),R({...E,indexes:B})},class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[e("option",{value:"",children:"Select column..."}),E.columns.filter(L=>L.name.trim()!=="").map(L=>e("option",{value:L.name,children:L.name},L.name))]}),s.columns.length>1&&e("button",{type:"button",onClick:()=>{const L=[...E.indexes];L[l].columns=L[l].columns.filter((B,z)=>z!==m),R({...E,indexes:L})},class:"text-red-600 hover:text-red-500 text-sm",children:"Remove"})]},m)),e("button",{type:"button",onClick:()=>{const f=[...E.indexes];f[l].columns.push(""),R({...E,indexes:f})},class:"text-xs text-indigo-600 hover:text-indigo-500",children:"Add Column"})]})]},l))})]}),e("div",{class:"flex space-x-3",children:[e("button",{type:"submit",class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Create"}),e("button",{type:"button",onClick:()=>{A(!1),R({name:"",columns:[{name:"",type:"TEXT",notNull:!1,foreignKey:{enabled:!1,table:"",column:""}}],indexes:[]}),u(null)},class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})]}),e("div",{class:"mt-8 grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e("div",{class:"lg:col-span-1",children:e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Tables"}),$&&!r?e("div",{class:"text-sm text-gray-500",children:"Loading..."}):e("div",{class:"space-y-4",children:[e("div",{children:[e("h4",{class:"text-sm font-medium text-gray-700 mb-2",children:"User Tables"}),e("div",{class:"space-y-1",children:[vt.map(s=>e("div",{class:`flex items-center justify-between p-2 rounded hover:bg-gray-50 ${r===s.name?"bg-indigo-50 border border-indigo-200":""}`,children:[e("div",{class:"flex-1 cursor-pointer",onClick:()=>a(s.name),children:[e("div",{class:"flex items-center gap-2",children:[e("div",{class:"text-sm font-medium text-gray-900",children:s.name}),s.access_policy&&e("span",{class:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${s.access_policy==="private"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:s.access_policy})]}),e("div",{class:"text-xs text-gray-500",children:[s.rowCount||0," rows"]})]}),s.type==="user"&&e("div",{class:"relative",children:[e("button",{onClick:l=>{l.stopPropagation(),te(M===s.name?null:s.name)},class:"p-1 text-gray-400 hover:text-gray-600 rounded",children:e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})})}),M===s.name&&e("div",{class:"absolute right-0 mt-1 w-24 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:e("button",{onClick:l=>{l.stopPropagation(),fn(s.name),te(null)},class:"w-full px-3 py-2 text-xs text-left text-red-600 hover:bg-red-50",children:"Drop Table"})})]})]},s.name)),vt.length===0&&e("p",{class:"text-sm text-gray-500",children:"No user tables yet"})]})]}),e("div",{children:[e("h4",{class:"text-sm font-medium text-gray-700 mb-2",children:"System Tables"}),e("div",{class:"space-y-1",children:An.map(s=>e("div",{class:`flex items-center justify-between p-2 rounded cursor-pointer hover:bg-gray-50 ${r===s.name?"bg-indigo-50 border border-indigo-200":""}`,onClick:()=>a(s.name),children:[e("div",{children:[e("div",{class:"text-sm font-medium text-gray-900",children:s.name}),e("div",{class:"text-xs text-gray-500",children:[s.rowCount||0," rows"]})]}),e("span",{class:"text-xs text-gray-400",children:"Protected"})]},s.name))})]})]})]})})}),e("div",{class:"lg:col-span-2",children:r?e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex items-center justify-between mb-4",children:[e("div",{class:"flex items-center gap-3",children:[e("h3",{class:"text-lg font-medium text-gray-900",children:r}),(()=>{const s=t.find(l=>l.name===r);return(s==null?void 0:s.type)==="user"&&s.access_policy?e("div",{class:"flex items-center gap-2",children:[e("select",{value:s.access_policy,onChange:l=>{const f=l.target.value;gn(r,f)},disabled:pt===r,class:`text-xs px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 ${s.access_policy==="private"?"border-red-300 bg-red-50 text-red-800":"border-green-300 bg-green-50 text-green-800"}`,children:[e("option",{value:"public",children:"public"}),e("option",{value:"private",children:"private"})]}),pt===r&&e("div",{class:"text-xs text-gray-500",children:"Updating..."})]}):null})()]}),((wt=t.find(s=>s.name===r))==null?void 0:wt.type)==="user"&&e("div",{class:"flex space-x-2",children:[e("button",{type:"button",onClick:()=>G(!le),class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Edit Schema"}),e("button",{type:"button",onClick:()=>{const s={};d.forEach(l=>{["id","created_at","updated_at"].includes(l.name)||(s[l.name]="")}),F(s),u(null),T(!0)},class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Add Record"})]})]}),le&&e("div",{class:"mb-6 p-4 border border-gray-200 rounded-lg",children:[e("h4",{class:"text-sm font-medium text-gray-900 mb-3",children:"Table Schema"}),e("div",{class:"mb-4",children:[e("h5",{class:"text-xs font-medium text-gray-700 mb-2",children:"Columns"}),e("div",{class:"space-y-2",children:d.map(s=>e("div",{class:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(Q==null?void 0:Q.oldName)===s.name?e("input",{type:"text",value:(Q==null?void 0:Q.newName)||"",onInput:l=>{Q&&pe({...Q,newName:l.target.value})},onKeyDown:l=>{Q&&(l.key==="Enter"&&bt(Q.oldName,Q.newName),l.key==="Escape"&&pe(null))},onBlur:()=>{Q&&bt(Q.oldName,Q.newName)},class:"flex-1 text-sm border-gray-300 rounded px-2 py-1",autoFocus:!0}):e("div",{class:"flex-1",children:[e("span",{class:"text-sm font-medium text-gray-900",children:s.name}),e("span",{class:"ml-2 text-xs text-gray-500",children:s.type}),s.notnull?e("span",{class:"ml-1 text-xs text-red-500",children:"NOT NULL"}):null,s.pk?e("span",{class:"ml-1 text-xs text-blue-500",children:"PRIMARY KEY"}):null,ce(s.name)&&e("span",{class:"ml-1 text-xs text-green-600",children:["FK → ",ce(s.name).table,".",ce(s.name).to]})]}),!["id","created_at","updated_at"].includes(s.name)&&e("div",{class:"flex space-x-2",children:[e("button",{onClick:()=>pe({oldName:s.name,newName:s.name}),class:"text-xs text-indigo-600 hover:text-indigo-500",children:"Rename"}),e("button",{onClick:()=>{const l=ce(s.name);P({name:s.name,type:s.type,notNull:s.notnull===1,foreignKey:{enabled:!!l,table:(l==null?void 0:l.table)||"",column:(l==null?void 0:l.to)||""}})},class:"text-xs text-blue-600 hover:text-blue-500",children:"Modify"}),e("button",{onClick:()=>_n(s.name),class:"text-xs text-red-600 hover:text-red-500",children:"Drop"})]})]},s.name))})]}),e("div",{class:"border-t pt-4",children:[e("h5",{class:"text-xs font-medium text-gray-700 mb-2",children:"Add Column"}),e("form",{onSubmit:wn,children:[e("div",{class:"flex space-x-2",children:[e("input",{type:"text",value:O.name,onInput:s=>de({...O,name:s.target.value}),placeholder:"column_name",pattern:"[a-zA-Z_][a-zA-Z0-9_]*",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",required:!0}),e("select",{value:O.type,onChange:s=>de({...O,type:s.target.value}),class:"border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[e("option",{value:"TEXT",children:"TEXT"}),e("option",{value:"INTEGER",children:"INTEGER"}),e("option",{value:"REAL",children:"REAL"}),e("option",{value:"BLOB",children:"BLOB"}),e("option",{value:"BOOLEAN",children:"BOOLEAN"})]}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:O.notNull,onChange:s=>de({...O,notNull:s.target.checked}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"NN"})]}),e("label",{class:"flex items-center space-x-1",children:[e("input",{type:"checkbox",checked:(_t=O.foreignKey)==null?void 0:_t.enabled,onChange:s=>de({...O,foreignKey:{...O.foreignKey,enabled:s.target.checked,column:s.target.checked?"id":""}}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-xs text-gray-700",children:"FK"})]}),e("button",{type:"submit",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Add"})]}),((kt=O.foreignKey)==null?void 0:kt.enabled)&&e("div",{class:"flex space-x-2 mt-2",children:[e("select",{value:((Ct=O.foreignKey)==null?void 0:Ct.table)||"",onChange:s=>de({...O,foreignKey:{...O.foreignKey,table:s.target.value}}),class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[e("option",{value:"",children:"Select table..."}),Ye(t).map(s=>e("option",{value:s.name,children:s.name},s.name))]}),e("input",{type:"text",value:((Et=O.foreignKey)==null?void 0:Et.column)||"",onChange:s=>de({...O,foreignKey:{...O.foreignKey,column:s.target.value}}),placeholder:"id",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]})]})]}),e("div",{class:"border-t pt-4",children:[e("div",{class:"flex items-center justify-between mb-3",children:[e("h5",{class:"text-xs font-medium text-gray-700",children:"Indexes"}),e("button",{type:"button",onClick:()=>ie(!X),class:"text-xs text-indigo-600 hover:text-indigo-500",children:X?"Hide":"Manage Indexes"})]}),e("div",{class:"space-y-2 mb-3",children:[w.map(s=>e("div",{class:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e("div",{class:"flex-1",children:[e("div",{class:"flex items-center space-x-2",children:[e("span",{class:"text-sm font-medium text-gray-900",children:s.name}),s.unique&&e("span",{class:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"UNIQUE"})]}),e("div",{class:"text-xs text-gray-500",children:["Columns: ",s.columns.join(", ")]})]}),e("button",{onClick:()=>$n(s.name),class:"text-xs text-red-600 hover:text-red-500",children:"Drop"})]},s.name)),w.length===0&&e("p",{class:"text-xs text-gray-500",children:"No custom indexes"})]}),X&&e("form",{onSubmit:Sn,class:"space-y-3 p-3 bg-blue-50 rounded-md",children:[e("h6",{class:"text-xs font-medium text-gray-700",children:"Create New Index"}),e("div",{children:e("input",{type:"text",value:Z.name,onInput:s=>xe({...Z,name:s.target.value}),placeholder:"index_name",pattern:"[a-zA-Z_][a-zA-Z0-9_]*",class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",required:!0})}),e("div",{class:"space-y-2",children:[e("label",{class:"text-xs text-gray-700",children:"Columns:"}),Z.columns.map((s,l)=>e("div",{class:"flex space-x-2",children:[e("select",{value:s,onChange:f=>{const m=[...Z.columns];m[l]=f.target.value,xe({...Z,columns:m})},class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm",children:[e("option",{value:"",children:"Select column..."}),d.map(f=>e("option",{value:f.name,children:f.name},f.name))]}),Z.columns.length>1&&e("button",{type:"button",onClick:()=>{const f=Z.columns.filter((m,L)=>L!==l);xe({...Z,columns:f})},class:"text-red-600 hover:text-red-500 text-sm",children:"Remove"})]},l)),e("button",{type:"button",onClick:()=>xe({...Z,columns:[...Z.columns,""]}),class:"text-xs text-indigo-600 hover:text-indigo-500",children:"Add Column"})]}),e("div",{children:e("label",{class:"flex items-center space-x-2",children:[e("input",{type:"checkbox",checked:Z.unique,onChange:s=>xe({...Z,unique:s.target.checked}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-sm text-gray-700",children:"Unique Index"})]})}),e("div",{class:"flex space-x-2",children:[e("button",{type:"submit",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Create Index"}),e("button",{type:"button",onClick:()=>{ie(!1),xe({name:"",columns:[""],unique:!1})},class:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})]})]}),C&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("h4",{class:"text-lg font-medium text-gray-900 mb-4",children:["Modify Column: ",C.name]}),e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Type"}),e("select",{value:C.type,onChange:s=>P({...C,type:s.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e("option",{value:"TEXT",children:"TEXT"}),e("option",{value:"INTEGER",children:"INTEGER"}),e("option",{value:"REAL",children:"REAL"}),e("option",{value:"BLOB",children:"BLOB"}),e("option",{value:"BOOLEAN",children:"BOOLEAN"})]})]}),e("div",{children:e("label",{class:"flex items-center space-x-2",children:[e("input",{type:"checkbox",checked:C.notNull,onChange:s=>P({...C,notNull:s.target.checked}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-sm text-gray-700",children:"NOT NULL"})]})}),e("div",{children:e("label",{class:"flex items-center space-x-2",children:[e("input",{type:"checkbox",checked:C.foreignKey.enabled,onChange:s=>P({...C,foreignKey:{...C.foreignKey,enabled:s.target.checked,column:s.target.checked?"id":""}}),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),e("span",{class:"text-sm text-gray-700",children:"Foreign Key"})]})}),C.foreignKey.enabled&&e("div",{class:"space-y-2",children:[e("select",{value:C.foreignKey.table,onChange:s=>P({...C,foreignKey:{...C.foreignKey,table:s.target.value}}),class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e("option",{value:"",children:"Select table..."}),Ye(t).map(s=>e("option",{value:s.name,children:s.name},s.name))]}),e("input",{type:"text",value:C.foreignKey.column,onChange:s=>P({...C,foreignKey:{...C.foreignKey,column:s.target.value}}),placeholder:"id",class:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]})]}),e("div",{class:"mt-6 flex space-x-3",children:[e("button",{onClick:()=>{var f,m;const s={};C.type!==((f=d.find(L=>L.name===C.name))==null?void 0:f.type)&&(s.type=C.type);const l=((m=d.find(L=>L.name===C.name))==null?void 0:m.notnull)===1;C.notNull!==l&&(s.notNull=C.notNull),C.foreignKey.enabled&&C.foreignKey.table&&C.foreignKey.column?s.foreignKey={table:C.foreignKey.table,column:C.foreignKey.column}:C.foreignKey.enabled||(s.foreignKey=null),kn(C.name,s)},class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Apply Changes"}),e("button",{onClick:()=>P(null),class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),oe&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-lg w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:"Validation Warning"})})]}),e("div",{class:"mb-4",children:[e("p",{class:"text-sm text-gray-700 mb-3",children:"The following issues were found with your changes:"}),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:[e("ul",{class:"list-disc list-inside space-y-1",children:oe.errors.map((s,l)=>e("li",{class:"text-sm text-yellow-800",children:s},l))}),oe.conflictingRows>0&&e("p",{class:"text-sm text-yellow-800 mt-2 font-medium",children:[oe.conflictingRows," rows will be affected."]})]}),e("p",{class:"text-sm text-gray-600 mt-3",children:"Proceeding may result in data loss or corruption. Are you sure you want to continue?"})]}),e("div",{class:"flex space-x-3",children:[e("button",{onClick:oe.onConfirm,class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Proceed Anyway"}),e("button",{onClick:()=>ee(null),class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),re&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e("div",{class:"flex items-center mb-4",children:[e("div",{class:"flex-shrink-0",children:re.variant==="danger"?e("svg",{class:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}):e("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e("div",{class:"ml-3",children:e("h3",{class:"text-lg font-medium text-gray-900",children:re.title})})]}),e("div",{class:"mb-6",children:e("p",{class:"text-sm text-gray-700",children:re.message})}),e("div",{class:"flex space-x-3",children:[e("button",{onClick:re.onConfirm,class:`inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 ${re.variant==="danger"?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"}`,children:"Confirm"}),e("button",{onClick:()=>h(null),class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),N&&e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e("div",{class:"flex items-center justify-between mb-4",children:[e("h3",{class:"text-lg font-medium text-gray-900",children:"Edit Record"}),e("button",{onClick:()=>K(null),class:"text-gray-400 hover:text-gray-600",children:e("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e("div",{class:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:d.map(s=>{if(["id","created_at","updated_at"].includes(s.name))return e("div",{class:"sm:col-span-2",children:[e("label",{class:"block text-sm font-medium text-gray-500",children:[s.name," (read-only)"]}),e("div",{class:"mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-sm text-gray-500",children:s.name.includes("_at")&&N.data[s.name]?gt(N.data[s.name]):N.data[s.name]||"-"})]},s.name);const l=ce(s.name);return e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:[s.name,s.notnull?e("span",{class:"text-red-500 ml-1",children:"*"}):null,l&&e("span",{class:"text-green-600 ml-1 text-xs",children:["FK → ",l.table,".",l.to]})]}),l?e("div",{class:"relative",children:[e("input",{type:"text",value:N.data[s.name]||"",onInput:f=>{const m=f.target.value;K({...N,data:{...N.data,[s.name]:m}}),m.trim()&&xt(m,l)},class:`mt-1 block w-full border rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm ${N.data[s.name]&&ae[`${l.table}-${N.data[s.name]}`]?ae[`${l.table}-${N.data[s.name]}`].isValid?"border-green-300 bg-green-50":"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:`Enter ${l.table} ID`,required:s.notnull===1}),N.data[s.name]&&ae[`${l.table}-${N.data[s.name]}`]&&e("div",{class:`absolute left-0 top-full mt-1 text-xs px-2 py-1 rounded ${ae[`${l.table}-${N.data[s.name]}`].isValid?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:ae[`${l.table}-${N.data[s.name]}`].isChecking?"Checking...":ae[`${l.table}-${N.data[s.name]}`].displayName})]}):e("input",{type:s.type==="INTEGER"||s.type==="REAL"?"number":"text",value:N.data[s.name]||"",onInput:f=>K({...N,data:{...N.data,[s.name]:f.target.value}}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",required:s.notnull===1})]},s.name)})}),e("div",{class:"mt-6 flex space-x-3",children:[e("button",{onClick:Tn,class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Save Changes"}),e("button",{onClick:()=>K(null),class:"inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})}),b&&e("div",{class:"mb-6 p-4 border border-gray-200 rounded-lg",children:[e("h4",{class:"text-sm font-medium text-gray-900 mb-3",children:"Create New Record"}),e("form",{onSubmit:hn,children:[e("div",{class:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:Object.entries(j).map(([s,l])=>e("div",{children:[e("label",{class:"block text-xs font-medium text-gray-700",children:s}),e("input",{type:"text",value:l,onInput:f=>F({...j,[s]:f.target.value}),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"})]},s))}),_&&b&&e("div",{class:"mt-3 bg-red-50 border border-red-200 rounded-md p-3",children:e("div",{class:"flex",children:[e("div",{class:"flex-shrink-0",children:e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})})}),e("div",{class:"ml-3",children:e("p",{class:"text-sm text-red-700",children:_})})]})}),e("div",{class:"mt-3 flex space-x-2",children:[e("button",{type:"submit",class:"inline-flex justify-center py-1.5 px-3 border border-transparent shadow-sm text-xs font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Create"}),e("button",{type:"button",onClick:()=>{T(!1),u(null)},class:"inline-flex justify-center py-1.5 px-3 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Cancel"})]})]})]}),$?e("div",{class:"text-center py-4 text-sm text-gray-500",children:"Loading data..."}):o.length===0?e("div",{class:"text-center py-8",children:e("p",{class:"text-sm text-gray-500",children:"No data in this table"})}):e("div",{class:"overflow-x-auto",children:e("table",{class:"min-w-full divide-y divide-gray-200",children:[e("thead",{class:"bg-gray-50",children:e("tr",{children:[d.map(s=>e("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s.name},s.name)),e("th",{class:"px-3 py-2"})]})}),e("tbody",{class:"bg-white divide-y divide-gray-200",children:o.map((s,l)=>{var f;return e("tr",{"data-record-id":s.id,children:[d.map(m=>{var L,B,z,H,ye,Tt,St,$t;return e("td",{class:`px-3 py-2 whitespace-nowrap text-sm text-gray-900 select-text ${!["id","created_at","updated_at"].includes(m.name)&&((L=t.find(V=>V.name===r))==null?void 0:L.type)==="user"?"cursor-pointer hover:bg-gray-50":""}`,onClick:V=>{var At;const me=`${s.id}-${m.name}`;if(["id","created_at","updated_at"].includes(m.name)||((At=t.find(Fe=>Fe.name===r))==null?void 0:At.type)!=="user")return;const je=se[me];if(je)clearTimeout(je.timeout),fe(Fe=>{const ke={...Fe};return delete ke[me],ke}),V.preventDefault(),V.stopPropagation(),Cn(s.id,m.name,s[m.name]);else{const Fe=setTimeout(()=>{fe(ke=>{const jt={...ke};return delete jt[me],jt})},400);fe(ke=>({...ke,[me]:{count:1,timeout:Fe}}))}},title:!["id","created_at","updated_at"].includes(m.name)&&((B=t.find(V=>V.name===r))==null?void 0:B.type)==="user"?"Double-click to edit":"",children:(v==null?void 0:v.rowId)===s.id&&(v==null?void 0:v.columnName)===m.name?e("div",{class:"relative",children:[e("input",{type:m.type==="INTEGER"||m.type==="REAL"?"number":"text",value:(v==null?void 0:v.value)||"",onInput:V=>{if(v){const me=V.target.value;D({...v,value:me});const je=ce(m.name);je&&me.trim()&&xt(me,je)}},onKeyDown:V=>{v&&(V.key==="Enter"&&!V.isComposing&&yt(s.id,m.name,v.value),V.key==="Escape"&&En())},onBlur:()=>{v&&yt(s.id,m.name,v.value)},class:`w-full px-2 py-1 border rounded focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${ce(m.name)&&(v!=null&&v.value)&&ae[`${(z=ce(m.name))==null?void 0:z.table}-${v.value}`]?ae[`${(H=ce(m.name))==null?void 0:H.table}-${v.value}`].isValid?"border-green-300 bg-green-50":"border-red-300 bg-red-50":"border-indigo-300"}`,ref:V=>{Je.current=V,V&&!Ae.current&&(Ae.current=!0,setTimeout(()=>{V.focus();const me=V.value.length;V.setSelectionRange(me,me)},0))}}),ce(m.name)&&(v==null?void 0:v.value)&&ae[`${(ye=ce(m.name))==null?void 0:ye.table}-${v.value}`]&&e("div",{class:`absolute left-0 -bottom-6 text-xs px-2 py-1 rounded ${ae[`${(Tt=ce(m.name))==null?void 0:Tt.table}-${v.value}`].isValid?"text-green-700 bg-green-100":"text-red-700 bg-red-100"}`,children:ae[`${(St=ce(m.name))==null?void 0:St.table}-${v.value}`].isChecking?"Checking...":ae[`${($t=ce(m.name))==null?void 0:$t.table}-${v.value}`].displayName})]}):m.name.includes("_at")&&s[m.name]?gt(s[m.name]):(m.name==="id"||m.name.endsWith("_id"))&&s[m.name]&&s[m.name].length>8?e("button",{onClick:V=>{V.stopPropagation(),xn(V,s[m.name],l,m.name)},onDblClick:V=>{V.preventDefault(),V.stopPropagation()},class:"text-blue-600 hover:text-blue-800 cursor-pointer underline decoration-dotted relative",title:"Click to copy • Cmd+Click to jump to record",children:[ar(s[m.name]),W===`${l}-${m.name}`&&e("span",{class:"absolute -top-8 left-0 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:"Copied!"})]}):s[m.name]||"-"},m.name)}),e("td",{class:"px-3 py-2 whitespace-nowrap text-right text-sm font-medium",children:((f=t.find(m=>m.name===r))==null?void 0:f.type)==="user"&&e("div",{class:"flex space-x-2",children:[e("button",{onClick:()=>{const m=o.find(L=>L.id===s.id);m&&K({id:s.id,data:{...m}})},class:"text-indigo-600 hover:text-indigo-900",children:"Edit"}),e("button",{onClick:()=>mn(s.id),class:"text-red-600 hover:text-red-900",children:"Delete"})]})})]},s.id||l)})})]})})]})}):e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6 text-center",children:[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e("h3",{class:"mt-2 text-sm font-medium text-gray-900",children:"No table selected"}),e("p",{class:"mt-1 text-sm text-gray-500",children:"Select a table from the list to view its data"})]})})})]}),Ge&&e(sr,{onClose:()=>Me(!1),onRestore:()=>{Ke(),r&&(_e(),be())}})]})}function cr(){const[t,n]=y([]),[r,a]=y(!0),[o,i]=y(null),[d,p]=y(!1),[x,g]=y(new Set);he(()=>{$()},[]);const $=async(k,A)=>{try{a(!0);const j=new URLSearchParams,F=await fetch(`/api/storage?${j}`);if(!F.ok)throw new Error("Failed to load files");const E=await F.json();n(A?[...t,...E.objects]:E.objects)}catch(j){i(j instanceof Error?j.message:"Unknown error")}finally{a(!1)}},c=async k=>{const A=k.target,j=A.files;if(j!=null&&j.length){p(!0);try{for(const F of Array.from(j)){const E=new FormData;if(E.append("file",F),!(await fetch("/api/storage/upload",{method:"POST",body:E})).ok)throw new Error(`Failed to upload ${F.name}`)}await $(),A.value=""}catch(F){i(F instanceof Error?F.message:"Upload failed")}finally{p(!1)}}},_=async k=>{if(confirm(`Delete ${k}?`))try{if(!(await fetch(`/api/storage/${encodeURIComponent(k)}`,{method:"DELETE"})).ok)throw new Error("Failed to delete file");n(t.filter(j=>j.key!==k))}catch(A){i(A instanceof Error?A.message:"Delete failed")}},u=async()=>{if(x.size!==0&&confirm(`Delete ${x.size} files?`))try{if(!(await fetch("/api/storage",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({keys:Array.from(x)})})).ok)throw new Error("Failed to delete files");n(t.filter(A=>!x.has(A.key))),g(new Set)}catch(k){i(k instanceof Error?k.message:"Bulk delete failed")}},b=k=>{if(k===0)return"0 B";const A=1024,j=["B","KB","MB","GB"],F=Math.floor(Math.log(k)/Math.log(A));return parseFloat((k/Math.pow(A,F)).toFixed(2))+" "+j[F]},T=k=>{const A=new Set(x);A.has(k)?A.delete(k):A.add(k),g(A)};return r&&t.length===0?e("div",{class:"flex items-center justify-center h-64",children:e("div",{class:"text-gray-500",children:"Loading files..."})}):e("div",{children:[e("div",{class:"flex justify-between items-center mb-6",children:[e("h2",{class:"text-2xl font-bold text-gray-900",children:"Storage"}),e("div",{class:"flex gap-2",children:[x.size>0&&e("button",{onClick:u,class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:["Delete Selected (",x.size,")"]}),e("label",{class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 cursor-pointer",children:[d?"Uploading...":"Upload Files",e("input",{type:"file",multiple:!0,onChange:c,disabled:d,class:"hidden"})]})]})]}),o&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:[e("p",{class:"text-red-600",children:o}),e("button",{onClick:()=>i(null),class:"mt-2 text-sm text-red-500 hover:text-red-700",children:"Dismiss"})]}),e("div",{class:"bg-white shadow rounded-lg overflow-hidden",children:e("table",{class:"min-w-full divide-y divide-gray-200",children:[e("thead",{class:"bg-gray-50",children:e("tr",{children:[e("th",{class:"w-12 px-6 py-3",children:e("input",{type:"checkbox",checked:x.size===t.length&&t.length>0,onChange:k=>{k.target.checked?g(new Set(t.map(j=>j.key))):g(new Set)}})}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{class:"bg-white divide-y divide-gray-200",children:t.length===0?e("tr",{children:e("td",{colSpan:6,class:"px-6 py-4 text-center text-gray-500",children:"No files uploaded yet"})}):t.map(k=>e("tr",{class:"hover:bg-gray-50",children:[e("td",{class:"px-6 py-4",children:e("input",{type:"checkbox",checked:x.has(k.key),onChange:()=>T(k.key)})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm font-medium text-gray-900",children:k.key})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:b(k.size)})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:k.contentType||"Unknown"})}),e("td",{class:"px-6 py-4 whitespace-nowrap",children:e("div",{class:"text-sm text-gray-900",children:new Date(k.uploaded).toLocaleString()})}),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e("a",{href:`/api/storage/download/${encodeURIComponent(k.key)}`,class:"text-blue-600 hover:text-blue-900 mr-4",download:!0,children:"Download"}),e("button",{onClick:()=>_(k.key),class:"text-red-600 hover:text-red-900",children:"Delete"})]})]},k.key))})]})})]})}function dr({supportedProvider:t,configuredProvider:n,onUpdate:r}){const[a,o]=y(!1),[i,d]=y(!1),[p,x]=y({client_id:(n==null?void 0:n.client_id)||"",client_secret:(n==null?void 0:n.client_secret)||"",is_enabled:(n==null?void 0:n.is_enabled)||!1,scopes:(n==null?void 0:n.scopes)||t.default_scopes}),[g,$]=y(!1),[c,_]=y(null),u=!!n,b=(n==null?void 0:n.is_enabled)||!1,T=async()=>{if(!p.client_id||!p.client_secret){_("Client ID and Client Secret are required");return}d(!0),_(null);try{await U.updateOAuthProvider(t.provider,p),o(!1),r()}catch(F){_(F instanceof Error?F.message:"Failed to save provider")}finally{d(!1)}},k=async()=>{if(u){d(!0),_(null);try{await U.toggleOAuthProvider(t.provider,!b),r()}catch(F){_(F instanceof Error?F.message:"Failed to toggle provider")}finally{d(!1)}}},A=async()=>{if(!(!u||!confirm(`Are you sure you want to delete the ${t.name} OAuth configuration?`))){d(!0),_(null);try{await U.deleteOAuthProvider(t.provider),r()}catch(F){_(F instanceof Error?F.message:"Failed to delete provider")}finally{d(!1)}}};return e("div",{class:"bg-white border border-gray-200 rounded-lg p-6",children:[e("div",{class:"flex items-start justify-between mb-4",children:[e("div",{class:"flex items-center gap-3",children:[e("div",{class:"w-8 h-8 flex items-center justify-center",children:(F=>({google:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),github:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})}),facebook:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#1877F2",children:e("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),linkedin:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#0A66C2",children:e("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),twitter:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),apple:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12.152 6.896c-.948 0-2.415-1.078-3.96-1.04-2.04.027-3.91 1.183-4.961 3.014-2.117 3.675-.546 9.103 1.519 12.09 1.013 1.454 2.208 3.09 3.792 3.039 1.52-.065 2.09-.987 3.935-.987 1.831 0 2.35.987 3.96.948 1.637-.026 2.676-1.48 3.676-2.948 1.156-1.688 1.636-3.325 1.662-3.415-.039-.013-3.182-1.221-3.22-4.857-.026-3.04 2.48-4.494 2.597-4.559-1.429-2.09-3.623-2.324-4.39-2.376-2-.156-3.675 1.09-4.61 1.09zM15.53 3.83c.843-1.012 1.4-2.427 1.245-3.83-1.207.052-2.662.805-3.532 1.818-.78.896-1.454 2.338-1.273 3.714 1.338.104 2.715-.688 3.559-1.701"})}),microsoft:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e("path",{d:"M0 0h11.377v11.372H0z",fill:"#F25022"}),e("path",{d:"M12.623 0H24v11.372H12.623z",fill:"#7FBA00"}),e("path",{d:"M0 12.628h11.377V24H0z",fill:"#00A4EF"}),e("path",{d:"M12.623 12.628H24V24H12.623z",fill:"#FFB900"})]}),discord:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#5865F2",children:e("path",{d:"M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419-.0190 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9460 2.4189-2.1568 2.4189Z"})}),slack:e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e("path",{d:"M5.042 15.165a2.528 2.528 0 01-2.52 2.523A2.528 2.528 0 010 15.165a2.527 2.527 0 012.522-2.52h2.52v2.52z",fill:"#E01E5A"}),e("path",{d:"M6.313 15.165a2.527 2.527 0 012.521-2.52 2.527 2.527 0 012.521 2.52v6.313A2.528 2.528 0 018.834 24a2.528 2.528 0 01-2.521-2.522v-6.313z",fill:"#E01E5A"}),e("path",{d:"M8.834 5.042a2.528 2.528 0 01-2.521-2.52A2.528 2.528 0 018.834 0a2.528 2.528 0 012.521 2.522v2.52H8.834z",fill:"#36C5F0"}),e("path",{d:"M8.834 6.313a2.528 2.528 0 012.521 2.521 2.528 2.528 0 01-2.521 2.521H2.522A2.528 2.528 0 010 8.834a2.528 2.528 0 012.522-2.521h6.312z",fill:"#36C5F0"}),e("path",{d:"M18.956 8.834a2.528 2.528 0 012.521-2.521A2.528 2.528 0 0124 8.834a2.528 2.528 0 01-2.523 2.521h-2.521V8.834z",fill:"#2EB67D"}),e("path",{d:"M17.688 8.834a2.528 2.528 0 01-2.523 2.521 2.527 2.527 0 01-2.52-2.521V2.522A2.527 2.527 0 0115.165 0a2.528 2.528 0 012.523 2.522v6.312z",fill:"#2EB67D"}),e("path",{d:"M15.165 18.956a2.528 2.528 0 012.523 2.521A2.528 2.528 0 0115.165 24a2.527 2.527 0 01-2.52-2.523v-2.521h2.52z",fill:"#ECB22E"}),e("path",{d:"M15.165 17.688a2.527 2.527 0 01-2.52-2.523 2.526 2.526 0 012.52-2.52h6.313A2.527 2.527 0 0124 15.165a2.528 2.528 0 01-2.522 2.523h-6.313z",fill:"#ECB22E"})]})})[F]||e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}))(t.provider)}),e("div",{children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:t.name}),e("div",{class:"flex items-center gap-2 mt-1",children:[e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${u?b?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:u?b?"Enabled":"Disabled":"Not Configured"}),t.note&&e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t.note})]})]})]}),e("div",{class:"flex items-center gap-2",children:[u&&e("button",{onClick:k,disabled:i,class:`px-3 py-1 text-sm rounded-md font-medium transition-colors ${b?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-green-100 text-green-800 hover:bg-green-200"} disabled:opacity-50`,children:b?"Disable":"Enable"}),e("button",{onClick:()=>o(!a),disabled:i,class:"px-3 py-1 text-sm rounded-md font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors disabled:opacity-50",children:a?"Cancel":u?"Edit":"Configure"})]})]}),c&&e("div",{class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:c})}),a?e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Client ID"}),e("input",{type:"text",value:p.client_id,onInput:F=>x({...p,client_id:F.target.value}),class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your OAuth Client ID"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),e("div",{class:"relative",children:[e("input",{type:g?"text":"password",value:p.client_secret,onInput:F=>x({...p,client_secret:F.target.value}),class:"w-full border border-gray-300 rounded-md px-3 py-2 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your OAuth Client Secret"}),e("button",{type:"button",onClick:()=>$(!g),class:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-600",children:g?"👁️":"👁️‍🗨️"})]})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-2",children:"Scopes"}),e("div",{class:"flex flex-wrap gap-2",children:p.scopes.map((F,E)=>e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:F},E))})]}),e("div",{class:"flex items-center gap-3 pt-4",children:[e("button",{onClick:T,disabled:i,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Saving...":"Save Configuration"}),u&&e("button",{onClick:A,disabled:i,class:"px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]})]}):e("div",{class:"space-y-3",children:[e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Setup Instructions:"}),e("p",{class:"mt-1",children:t.setup_instructions})]}),e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"OAuth Callback URL for Provider:"}),e("br",{}),e("code",{class:"px-2 py-1 bg-gray-100 rounded text-xs",children:[window.location.origin,"/api/auth/callback/",t.provider]}),e("p",{class:"mt-1 text-xs text-gray-500",children:"Use this URL when configuring your OAuth application with the provider. After authentication, users will be redirected to your app based on the callback URLs you configure in your application settings."})]}),e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Default Scopes:"}),e("div",{class:"flex flex-wrap gap-1 mt-1",children:t.default_scopes.map((F,E)=>e("span",{class:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-700",children:F},E))})]}),u&&e("div",{class:"pt-2 border-t border-gray-100",children:[e("div",{class:"text-sm text-gray-600",children:[e("strong",{children:"Status:"})," Configured and ",b?"enabled":"disabled"]}),n&&e("div",{class:"text-sm text-gray-600 mt-1",children:[e("strong",{children:"Last updated:"})," ",new Date(n.updated_at).toLocaleDateString()]})]})]})]})}function ur(){const[t,n]=y([]),[r,a]=y(""),[o,i]=y(!0),[d,p]=y(!1),[x,g]=y(null),$=async()=>{try{i(!0),g(null);const T=await fetch("/api/app-settings",{credentials:"include"});if(!T.ok)throw new Error("Failed to load app settings");const k=await T.json();n(k.settings.allowed_callback_urls||[])}catch(T){console.error("Failed to load callback URLs:",T),g(T instanceof Error?T.message:"Failed to load callback URLs")}finally{i(!1)}},c=async T=>{try{if(p(!0),g(null),!(await fetch("/api/app-settings",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({allowed_callback_urls:T})})).ok)throw new Error("Failed to save callback URLs");n(T)}catch(k){console.error("Failed to save callback URLs:",k),g(k instanceof Error?k.message:"Failed to save callback URLs")}finally{p(!1)}},_=async()=>{if(!r.trim())return;const T=[...t,r.trim()];await c(T),a("")},u=async T=>{const k=t.filter((A,j)=>j!==T);await c(k)},b=T=>{T.key==="Enter"&&(T.preventDefault(),_())};return he(()=>{$()},[]),o?e("div",{class:"flex items-center justify-center py-12",children:e("div",{class:"text-gray-500",children:"Loading callback URLs..."})}):e("div",{children:[e("div",{class:"mb-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:"Allowed Callback URLs"}),e("p",{class:"text-gray-600 mt-2",children:"Configure URLs where users can be redirected after OAuth authentication. Supports web URLs (https://), mobile deep links (myapp://), and localhost for development."})]}),x&&e("div",{class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:x})}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[e("h4",{class:"text-md font-medium text-gray-900 mb-4",children:"Add Callback URL"}),e("div",{class:"flex gap-3",children:[e("input",{type:"text",value:r,onInput:T=>a(T.target.value),onKeyPress:b,placeholder:"https://myapp.com/auth/callback or myapp://auth/callback",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e("button",{onClick:_,disabled:!r.trim()||d,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Adding...":"Add URL"})]})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-6",children:[e("h4",{class:"text-md font-medium text-gray-900 mb-4",children:["Configured URLs (",t.length,")"]}),t.length===0?e("div",{class:"text-center py-8 text-gray-500",children:[e("p",{class:"mb-2",children:"No callback URLs configured"}),e("p",{class:"text-sm",children:"When no URLs are configured, any callback URL will be allowed (for backward compatibility)"})]}):e("div",{class:"space-y-3",children:t.map((T,k)=>e("div",{class:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e("div",{class:"flex-1",children:[e("code",{class:"text-sm text-gray-800",children:T}),e("div",{class:"text-xs text-gray-500 mt-1",children:T.startsWith("https://")?"🌐 Web App":T.startsWith("http://localhost")||T.startsWith("http://127.0.0.1")?"🔧 Development":T.includes("://")?"📱 Mobile/Desktop App":"❓ Unknown"})]}),e("button",{onClick:()=>u(k),disabled:d,class:"ml-3 text-red-600 hover:text-red-800 text-sm font-medium disabled:opacity-50",children:"Remove"})]},k))})]}),e("div",{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e("h4",{class:"text-lg font-semibold text-blue-900 mb-3",children:"URL Format Examples"}),e("div",{class:"space-y-2 text-sm text-blue-800",children:[e("p",{children:[e("strong",{children:"Web Applications:"})," ",e("code",{children:"https://myapp.com/auth/callback"})]}),e("p",{children:[e("strong",{children:"Mobile Apps:"})," ",e("code",{children:"myapp://auth/callback"})," or ",e("code",{children:"com.example.myapp://callback"})]}),e("p",{children:[e("strong",{children:"Desktop Apps:"})," ",e("code",{children:"myapp://localhost/callback"})]}),e("p",{children:[e("strong",{children:"Development:"})," ",e("code",{children:"http://localhost:3000/callback"})," or ",e("code",{children:"http://127.0.0.1:8080/auth"})]})]})]}),e("div",{class:"mt-6 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e("h4",{class:"text-lg font-semibold text-gray-900 mb-3",children:"API Usage"}),e("div",{class:"space-y-2 text-sm font-mono text-gray-700",children:[e("p",{children:e("strong",{children:"Login with callback:"})}),e("code",{class:"block bg-white p-2 rounded border",children:"GET /api/auth/login/google?callback_url=https://myapp.com/auth/callback"}),e("p",{class:"mt-3",children:e("strong",{children:"The callback response includes:"})}),e("code",{class:"block bg-white p-2 rounded border text-xs",children:JSON.stringify({success:!0,access_token:"...",refresh_token:"...",user:{id:"...",email:"...",name:"..."},return_url:"https://myapp.com/auth/callback"},null,2)})]})]})]})}function hr(){const[t,n]=y("providers"),[r,a]=y([]),[o,i]=y([]),[d,p]=y(!0),[x,g]=y(null),$=async()=>{p(!0),g(null);try{const[b,T]=await Promise.all([U.getSupportedProviders(),U.getOAuthProviders()]);a(b.supported_providers),i(T.providers)}catch(b){g(b instanceof Error?b.message:"Failed to load OAuth providers"),console.error("Error loading OAuth providers:",b)}finally{p(!1)}};he(()=>{$()},[]);const c=b=>o.find(T=>T.provider===b),_=o.filter(b=>b.is_enabled).length,u=o.length;return d?e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Authentication"}),e("div",{class:"flex items-center justify-center py-12",children:e("div",{class:"text-gray-500",children:"Loading OAuth providers..."})})]}):e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Authentication"}),e("div",{class:"flex gap-6",children:[e("div",{class:"w-64 flex-shrink-0",children:e("nav",{class:"space-y-1",children:[e("button",{onClick:()=>n("providers"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="providers"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"OAuth Providers"}),e("button",{onClick:()=>n("callback-urls"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="callback-urls"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"Callback URLs"})]})}),e("div",{class:"flex-1 min-w-0",children:[t==="providers"&&e("div",{children:[e("div",{class:"mb-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900",children:"OAuth Providers"}),e("p",{class:"text-gray-600 mt-2",children:"Configure OAuth providers to enable user authentication in your applications"})]}),x&&e("div",{class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:[e("p",{class:"text-sm text-red-600",children:x}),x.includes("authentication required")?e("div",{class:"mt-3",children:[e("p",{class:"text-sm text-red-700 mb-2",children:"You need to log in as an administrator to manage OAuth settings."}),e("a",{href:"/",class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Go to Dashboard"})]}):e("button",{onClick:$,class:"mt-2 text-sm text-red-700 hover:text-red-800 underline",children:"Try again"})]}),e("div",{class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-gray-900",children:r.length}),e("div",{class:"text-sm text-gray-600",children:"Supported Providers"})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-blue-600",children:u}),e("div",{class:"text-sm text-gray-600",children:"Configured"})]}),e("div",{class:"bg-white border border-gray-200 rounded-lg p-4",children:[e("div",{class:"text-2xl font-bold text-green-600",children:_}),e("div",{class:"text-sm text-gray-600",children:"Enabled"})]})]}),e("div",{class:"space-y-6",children:r.map(b=>e(dr,{supportedProvider:b,configuredProvider:c(b.provider),onUpdate:$},b.provider))}),e("div",{class:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e("h3",{class:"text-lg font-semibold text-blue-900 mb-3",children:"Getting Started"}),e("div",{class:"space-y-2 text-sm text-blue-800",children:[e("p",{children:["1. ",e("strong",{children:"Choose a provider:"}),' Click "Configure" on any OAuth provider you want to enable']}),e("p",{children:["2. ",e("strong",{children:"Create OAuth app:"})," Follow the setup instructions to create an OAuth application"]}),e("p",{children:["3. ",e("strong",{children:"Configure credentials:"})," Enter your Client ID and Client Secret"]}),e("p",{children:["4. ",e("strong",{children:"Enable provider:"}),' Toggle the provider to "Enabled" status']}),e("p",{children:["5. ",e("strong",{children:"Test authentication:"})," Users can now authenticate with this provider"]})]})]}),e("div",{class:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e("h3",{class:"text-lg font-semibold text-gray-900 mb-3",children:"Authentication Endpoints"}),e("div",{class:"space-y-2 text-sm font-mono text-gray-700",children:[e("div",{children:[e("strong",{children:"Available providers:"})," ",e("code",{children:"GET /api/auth/providers"})]}),e("div",{children:[e("strong",{children:"Start authentication:"})," ",e("code",{children:["GET /api/auth/login/","{{provider}}"]})]}),e("div",{children:[e("strong",{children:"OAuth callback:"})," ",e("code",{children:["GET /api/auth/callback/","{{provider}}"]})]}),e("div",{children:[e("strong",{children:"Get user info:"})," ",e("code",{children:"GET /api/auth/me"})]}),e("div",{children:[e("strong",{children:"Refresh token:"})," ",e("code",{children:"POST /api/auth/refresh"})]}),e("div",{children:[e("strong",{children:"Logout:"})," ",e("code",{children:"POST /api/auth/logout"})]})]})]})]}),t==="callback-urls"&&e(ur,{})]})]})]})}function mr(){const[t,n]=y("app-settings"),[r,a]=y([]),[o,i]=y(!1),[d,p]=y(null),[x,g]=y(""),[$,c]=y(!1),[_,u]=y(null),[b,T]=y([]),[k,A]=y(!1),[j,F]=y(null),[E,R]=y(!1),[M,te]=y({name:"",scopes:[],expires_in_days:30}),[W,ne]=y(null),[le]=y(["data:read","data:write","data:delete","tables:read","tables:write","tables:delete","storage:read","storage:write","storage:delete"]),[G,O]=y(null),[de,Q]=y([]),[pe,C]=y(!1),[P,oe]=y(null),[ee,re]=y(!1),[h,v]=y({}),[D,N]=y(!1),K=async()=>{try{i(!0),p(null);const w=await fetch("/api/admin",{credentials:"include"});if(!w.ok)throw new Error("Failed to load admins");const S=await w.json();a(S.admins)}catch(w){console.error("Failed to load admins:",w),p(w instanceof Error?w.message:"Failed to load admins")}finally{i(!1)}},se=async w=>{if(w.preventDefault(),!x.trim()){p("GitHub username is required");return}try{c(!0),p(null);const S=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({github_username:x.trim()})});if(!S.ok){const X=await S.json();throw new Error(X.error||"Failed to add admin")}g(""),await K()}catch(S){console.error("Failed to add admin:",S),p(S instanceof Error?S.message:"Failed to add admin")}finally{c(!1)}},fe=async w=>{try{p(null);const S=await fetch(`/api/admin/${w}`,{method:"DELETE",credentials:"include"});if(!S.ok){const X=await S.json();throw new Error(X.error||"Failed to remove admin")}u(null),await K()}catch(S){console.error("Failed to remove admin:",S),p(S instanceof Error?S.message:"Failed to remove admin")}},ae=async()=>{try{A(!0),F(null);const w=await fetch("/api/api-keys/init",{method:"POST",credentials:"include"});if(!w.ok){const ie=await w.json().catch(()=>({}))}const S=await fetch("/api/api-keys",{credentials:"include"});if(!S.ok){const ie=await S.json().catch(()=>({}));throw new Error(`Failed to load API keys: ${S.status} - ${ie.error||"Unknown error"}`)}const X=await S.json();T(X.data||[])}catch(w){console.error("Failed to load API keys:",w);let S="Failed to load API keys";w instanceof Error&&(S=w.message),typeof w=="object"&&w!==null&&"status"in w&&(S+=` (Status: ${w.status})`),F(S)}finally{A(!1)}},$e=async w=>{if(w.preventDefault(),!M.name.trim()||M.scopes.length===0){F("Name and at least one scope are required");return}try{F(null);const S=await fetch("/api/api-keys",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(M)});if(!S.ok){const ie=await S.json().catch(()=>({})),Z=`Failed to create API key: ${S.status} - ${ie.error||"Unknown error"}`;throw ie.details?new Error(`${Z}. Details: ${JSON.stringify(ie.details)}`):new Error(Z)}const X=await S.json();ne(X.data),R(!1),te({name:"",scopes:[],expires_in_days:30}),await ae()}catch(S){console.error("Failed to create API key:",S),F(S instanceof Error?S.message:"Failed to create API key")}},Je=async w=>{try{F(null);const S=await fetch(`/api/api-keys/${w}/revoke`,{method:"PATCH",credentials:"include"});if(!S.ok){const X=await S.json().catch(()=>({})),ie=`Failed to revoke API key: ${S.status} - ${X.error||"Unknown error"}`;throw X.details?new Error(`${ie}. Details: ${JSON.stringify(X.details)}`):new Error(ie)}O(null),await ae()}catch(S){console.error("Failed to revoke API key:",S),F(S instanceof Error?S.message:"Failed to revoke API key")}},Ae=w=>{te(S=>({...S,scopes:S.scopes.includes(w)?S.scopes.filter(X=>X!==w):[...S.scopes,w]}))},Ge=async()=>{try{C(!0),oe(null);const w=await fetch("/api/app-settings",{credentials:"include"});if(!w.ok)throw new Error("Failed to load app settings");const S=await w.json();Q(S.settings);const X={};S.settings.forEach(ie=>{X[ie.key]=ie.value}),v(X)}catch(w){console.error("Failed to load app settings:",w),oe(w instanceof Error?w.message:"Failed to load app settings")}finally{C(!1)}},Me=async()=>{try{N(!0),oe(null);const w=await fetch("/api/app-settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(h)});if(!w.ok)throw new Error("Failed to save app settings");const S=await w.json();Q(S.settings),re(!1)}catch(w){console.error("Failed to save app settings:",w),oe(w instanceof Error?w.message:"Failed to save app settings")}finally{N(!1)}};return he(()=>{K(),ae(),Ge()},[]),e("div",{children:[e("h2",{class:"text-2xl font-bold text-gray-900 mb-6",children:"Settings"}),e("div",{class:"flex gap-6",children:[e("div",{class:"w-64 flex-shrink-0",children:e("nav",{class:"space-y-1",children:[e("button",{onClick:()=>n("app-settings"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="app-settings"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"Application Settings"}),e("button",{onClick:()=>n("admins"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="admins"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"Admin Management"}),e("button",{onClick:()=>n("api-keys"),class:`w-full text-left px-3 py-2 text-sm font-medium rounded-md transition-colors ${t==="api-keys"?"bg-blue-50 text-blue-700 border-l-4 border-blue-700":"text-gray-700 hover:bg-gray-50"}`,children:"API Keys"})]})}),e("div",{class:"flex-1",children:[t==="app-settings"&&e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex justify-between items-center mb-4",children:[e("h3",{class:"text-lg font-medium text-gray-900",children:"Application Settings"}),!ee&&e("button",{onClick:()=>re(!0),class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Edit Settings"})]}),P&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:P})}),pe?e("p",{class:"text-gray-500",children:"Loading app settings..."}):e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Application Name"}),e("input",{type:"text",value:h.app_name||"",onChange:w=>v(S=>({...S,app_name:w.target.value})),disabled:!ee,class:`w-full px-3 py-2 border ${ee?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"My Vibebase App"}),e("p",{class:"mt-1 text-sm text-gray-500",children:"Used as User-Agent for OAuth providers"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Application URL (optional)"}),e("input",{type:"url",value:h.app_url||"",onChange:w=>v(S=>({...S,app_url:w.target.value})),disabled:!ee,class:`w-full px-3 py-2 border ${ee?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"https://myapp.com"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Support Email (optional)"}),e("input",{type:"email",value:h.support_email||"",onChange:w=>v(S=>({...S,support_email:w.target.value})),disabled:!ee,class:`w-full px-3 py-2 border ${ee?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"support@myapp.com"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Application Description (optional)"}),e("textarea",{value:h.app_description||"",onChange:w=>v(S=>({...S,app_description:w.target.value})),disabled:!ee,rows:3,class:`w-full px-3 py-2 border ${ee?"border-gray-300":"border-gray-200 bg-gray-50"} rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500`,placeholder:"A brief description of your application"})]}),ee&&e("div",{class:"flex gap-3 pt-4",children:[e("button",{onClick:()=>{re(!1);const w={};de.forEach(S=>{w[S.key]=S.value}),v(w)},disabled:D,class:"px-4 py-2 border border-gray-300 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Cancel"}),e("button",{onClick:Me,disabled:D,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300 disabled:opacity-50",children:D?"Saving...":"Save Settings"})]})]})]})}),t==="admins"&&e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Admin Management"}),d&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:d})}),e("form",{onSubmit:se,class:"mb-6",children:e("div",{class:"flex gap-2",children:[e("input",{type:"text",value:x,onInput:w=>g(w.target.value),placeholder:"GitHub username (e.g., meso)",class:"flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:$}),e("button",{type:"submit",disabled:$||!x.trim(),class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:$?"Adding...":"Add Admin"})]})}),o?e("div",{class:"text-center py-4",children:e("p",{class:"text-gray-500",children:"Loading admins..."})}):e("div",{class:"space-y-2",children:[e("h4",{class:"text-sm font-medium text-gray-700 mb-2",children:"Current Admins"}),r.length===0?e("p",{class:"text-sm text-gray-500",children:"No admins found"}):e("div",{class:"space-y-2",children:r.map(w=>e("div",{class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e("div",{class:"flex items-center space-x-3",children:e("div",{children:[e("p",{class:"text-sm font-medium text-gray-900",children:[w.github_username,w.is_root&&e("span",{class:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Root Admin"})]}),e("p",{class:"text-xs text-gray-500",children:["Added ",new Date(w.created_at).toLocaleDateString()]})]})}),!w.is_root&&e("button",{onClick:()=>u({id:w.id,username:w.github_username}),class:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Remove"})]},w.id))})]})]})}),t==="api-keys"&&e("div",{class:"bg-white shadow rounded-lg",children:e("div",{class:"px-4 py-5 sm:p-6",children:[e("div",{class:"flex items-center justify-between mb-4",children:[e("h3",{class:"text-lg font-medium text-gray-900",children:"API Keys"}),e("div",{class:"flex items-center space-x-2",children:e("button",{onClick:()=>R(!0),class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Create API Key"})})]}),j&&e("div",{class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e("p",{class:"text-sm text-red-600",children:j})}),k?e("div",{class:"text-center py-4",children:e("p",{class:"text-gray-500",children:"Loading API keys..."})}):e("div",{class:"space-y-2",children:b.length===0?e("p",{class:"text-sm text-gray-500",children:"No API keys found. Create one to get started."}):e("div",{class:"space-y-3",children:b.map(w=>e("div",{class:"border border-gray-200 rounded-lg p-4",children:e("div",{class:"flex items-start justify-between",children:[e("div",{class:"flex-1",children:[e("div",{class:"flex items-center space-x-2 mb-2",children:[e("h4",{class:"text-sm font-medium text-gray-900",children:w.name}),e("span",{class:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${w.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:w.is_active?"Active":"Revoked"})]}),e("div",{class:"text-sm text-gray-600 space-y-1",children:[e("p",{children:[e("span",{class:"font-medium",children:"Key:"})," ",w.key_prefix]}),e("p",{children:[e("span",{class:"font-medium",children:"Scopes:"})," ",w.scopes.join(", ")]}),e("p",{children:[e("span",{class:"font-medium",children:"Created:"})," ",new Date(w.created_at).toLocaleDateString()]}),w.expires_at&&e("p",{children:[e("span",{class:"font-medium",children:"Expires:"})," ",new Date(w.expires_at).toLocaleDateString()]}),w.last_used_at&&e("p",{children:[e("span",{class:"font-medium",children:"Last used:"})," ",new Date(w.last_used_at).toLocaleDateString()]})]})]}),w.is_active&&e("button",{onClick:()=>O({id:w.id,name:w.name}),class:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Revoke"})]})},w.id))})})]})}),E&&e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e("div",{class:"mt-3",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Create New API Key"}),e("form",{onSubmit:$e,children:[e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),e("input",{type:"text",value:M.name,onInput:w=>te(S=>({...S,name:w.target.value})),placeholder:"My Backend Service",class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),e("div",{class:"space-y-2 max-h-32 overflow-y-auto",children:le.map(w=>e("label",{class:"flex items-center",children:[e("input",{type:"checkbox",checked:M.scopes.includes(w),onChange:()=>Ae(w),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e("span",{class:"ml-2 text-sm text-gray-700",children:w})]},w))})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-1",children:"Expires in (days)"}),e("select",{value:M.expires_in_days||"",onChange:w=>te(S=>({...S,expires_in_days:w.target.value?parseInt(w.target.value):void 0})),class:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e("option",{value:"7",children:"7 days"}),e("option",{value:"30",children:"30 days"}),e("option",{value:"90",children:"90 days"}),e("option",{value:"365",children:"1 year"}),e("option",{value:"",children:"Never"})]})]})]}),e("div",{class:"flex space-x-3 mt-6",children:[e("button",{type:"button",onClick:()=>R(!1),class:"flex-1 px-4 py-2 bg-gray-500 text-white text-sm font-medium rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"}),e("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Create Key"})]})]})]})})})]})]}),W&&e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e("div",{class:"mt-3",children:[e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4",children:e("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})})}),e("h3",{class:"text-lg font-medium text-gray-900 text-center mb-4",children:"API Key Created"}),e("div",{class:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4",children:[e("p",{class:"text-sm text-yellow-800 mb-2",children:[e("strong",{children:"Important:"})," Save this key securely. It will not be shown again."]}),e("div",{class:"bg-white p-3 rounded border",children:e("code",{class:"text-sm break-all",children:W.key})})]}),e("div",{class:"text-sm text-gray-600 space-y-1 mb-4",children:[e("p",{children:[e("strong",{children:"Name:"})," ",W.name]}),e("p",{children:[e("strong",{children:"Scopes:"})," ",W.scopes.join(", ")]}),W.expires_at&&e("p",{children:[e("strong",{children:"Expires:"})," ",new Date(W.expires_at).toLocaleDateString()]})]}),e("button",{onClick:()=>ne(null),class:"w-full px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"I've saved the key safely"})]})})}),G&&e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e("div",{class:"mt-3 text-center",children:[e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("h3",{class:"text-lg font-medium text-gray-900 mt-2",children:"Revoke API Key"}),e("div",{class:"mt-2 px-7 py-3",children:e("p",{class:"text-sm text-gray-500",children:['Are you sure you want to revoke the API key "',G.name,'"? This action cannot be undone and will immediately disable the key.']})}),e("div",{class:"items-center px-4 py-3",children:e("div",{class:"flex space-x-3",children:[e("button",{onClick:()=>O(null),class:"flex-1 px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"}),e("button",{onClick:()=>Je(G.id),class:"flex-1 px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-300",children:"Revoke"})]})})]})})}),_&&e("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e("div",{class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e("div",{class:"mt-3 text-center",children:[e("div",{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:e("svg",{class:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"})})}),e("h3",{class:"text-lg font-medium text-gray-900 mt-2",children:"Remove Admin"}),e("div",{class:"mt-2 px-7 py-3",children:e("p",{class:"text-sm text-gray-500",children:['Are you sure you want to remove admin "',_.username,'"? This action cannot be undone.']})}),e("div",{class:"items-center px-4 py-3",children:e("div",{class:"flex space-x-3",children:[e("button",{onClick:()=>u(null),class:"flex-1 px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"}),e("button",{onClick:()=>fe(_.id),class:"flex-1 px-4 py-2 bg-red-600 text-white text-base font-medium rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-300",children:"Remove"})]})})]})})})]})}function pr(){const[t,n]=y([]),[r,a]=y(null),[o,i]=y(!1),[d,p]=y(!1),[x,g]=y(!0),[$,c]=y(null),[_,u]=y({}),[b,T]=y({slug:"",name:"",description:"",sql_query:"",parameters:[],cache_ttl:0,enabled:!0}),k=h=>{if(!h.trim())return Date.now().toString(36).slice(-8).padStart(8,"0");let v=h.length+1e3;for(let K=0;K<h.length;K++){const se=h.charCodeAt(K);v=v*31+se,v=v&2147483647}let D="",N=v;for(let K=0;K<8;K++){N=N*1664525+1013904223&2147483647;const se=N%36;D+=se.toString(36)}return D},A=h=>{const v=/:(\w+)/g,D=new Set;let N;for(;(N=v.exec(h))!==null;)D.add(N[1]);return Array.from(D).map(K=>({name:K,type:"string",required:!0,description:""}))},j=h=>{const v=h.trim().toLowerCase(),D=v.startsWith("select"),N=v.includes("pragma");return{method:D?"GET":"POST",readonly:D||N}},F=()=>{const h={};if(b.name.trim()||(h.name="クエリ名は必須です"),b.slug.trim()?/^[a-z0-9_-]+$/.test(b.slug)||(h.slug="スラッグは小文字の英数字、ハイフン、アンダースコアのみ使用できます"):h.slug="スラッグは必須です",!b.sql_query.trim())h.sql_query="SQLクエリは必須です";else{const v=/:(\w+)/g,D=new Set;let N;for(;(N=v.exec(b.sql_query))!==null;)D.add(N[1]);const K=new Set(b.parameters.map(fe=>fe.name)),se=Array.from(D).filter(fe=>!K.has(fe));se.length>0&&(h.sql_query=`SQLに未定義のパラメーターが含まれています: ${se.join(", ")}`)}return b.parameters.forEach((v,D)=>{v.name.trim()?/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(v.name)||(h[`parameter_${D}_name`]="パラメーター名は英文字またはアンダースコアで始まり、英数字とアンダースコアのみ使用できます"):h[`parameter_${D}_name`]="パラメーター名は必須です"}),u(h),Object.keys(h).length===0},[E,R]=y({}),[M,te]=y(null),[W,ne]=y(null),[le,G]=y(!1);he(()=>{O()},[]);const O=async()=>{try{const h=await fetch("/api/custom-queries");if(!h.ok)throw new Error("Failed to fetch queries");const v=await h.json();n(v.queries)}catch(h){c(h instanceof Error?h.message:"Failed to fetch queries")}finally{g(!1)}},de=async()=>{if(c(null),u({}),!!F())try{const h=await fetch("/api/custom-queries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!h.ok){const D=(await h.json()).error||"Failed to create query";if(D.includes("slug already exists")){u({slug:"このスラッグは既に使用されています"});return}throw new Error(D)}await O(),i(!1),P()}catch(h){c(h instanceof Error?h.message:"Failed to create query")}},Q=async()=>{if(r&&(c(null),u({}),!!F()))try{const h=await fetch(`/api/custom-queries/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!h.ok){const D=(await h.json()).error||"Failed to update query";if(D.includes("slug already exists")){u({slug:"このスラッグは既に使用されています"});return}throw new Error(D)}await O(),p(!1),a(null),P()}catch(h){c(h instanceof Error?h.message:"Failed to update query")}},pe=async h=>{if(confirm("Are you sure you want to delete this query?"))try{if(!(await fetch(`/api/custom-queries/${h}`,{method:"DELETE"})).ok)throw new Error("Failed to delete query");await O(),(r==null?void 0:r.id)===h&&a(null)}catch(v){c(v instanceof Error?v.message:"Failed to delete query")}},C=async()=>{if(r){G(!0),te(null),ne(null);try{const h=await fetch(`/api/custom-queries/${r.id}/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parameters:E})}),v=await h.json();if(!h.ok)throw new Error(v.error||"Failed to test query");te(v)}catch(h){ne(h instanceof Error?h.message:"Failed to test query")}finally{G(!1)}}},P=()=>{T({slug:"",name:"",description:"",sql_query:"",parameters:[],cache_ttl:0,enabled:!0}),u({}),c(null)},oe=()=>{T({...b,parameters:[...b.parameters,{name:"",type:"string",required:!1}]})},ee=h=>{T({...b,parameters:b.parameters.filter((v,D)=>D!==h)})},re=(h,v)=>{if(T({...b,parameters:b.parameters.map((D,N)=>N===h?{...D,...v}:D)}),v.name!==void 0){const D=`parameter_${h}_name`;_[D]&&u(N=>{const K={...N};return delete K[D],K})}};return x?e("div",{class:"flex justify-center items-center h-64",children:e("div",{class:"text-gray-500",children:"Loading custom queries..."})}):e("div",{class:"space-y-6",children:[e("div",{class:"flex justify-between items-center",children:[e("h2",{class:"text-2xl font-bold text-gray-900",children:"Custom SQL APIs"}),e("button",{onClick:()=>i(!0),class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Create Query"})]}),$&&e("div",{class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:$}),e("div",{class:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e("div",{class:"bg-white shadow rounded-lg p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:"Queries"}),e("div",{class:"space-y-2",children:t.length===0?e("p",{class:"text-gray-500",children:"No custom queries yet"}):t.map(h=>e("div",{class:`p-3 border rounded cursor-pointer hover:bg-gray-50 ${(r==null?void 0:r.id)===h.id?"border-indigo-500 bg-indigo-50":"border-gray-200"}`,onClick:()=>{const v={...h,parameters:typeof h.parameters=="string"?JSON.parse(h.parameters||"[]"):h.parameters||[]};a(v),R({}),te(null),ne(null)},children:e("div",{class:"flex justify-between items-start",children:[e("div",{children:[e("h4",{class:"font-medium text-gray-900",children:h.name}),e("p",{class:"text-sm text-gray-500",children:["/",h.slug]}),e("div",{class:"flex gap-2 mt-1",children:[e("span",{class:`text-xs px-2 py-1 rounded ${h.method==="GET"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:h.method}),e("span",{class:`text-xs px-2 py-1 rounded ${h.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:h.enabled?"Enabled":"Disabled"}),h.is_readonly&&e("span",{class:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-800",children:"Read-only"})]})]}),e("div",{class:"flex gap-2",children:[e("button",{onClick:v=>{v.stopPropagation(),a(h),T({slug:h.slug,name:h.name,description:h.description||"",sql_query:h.sql_query,parameters:h.parameters||[],cache_ttl:h.cache_ttl,enabled:!!h.enabled}),p(!0)},class:"text-indigo-600 hover:text-indigo-800",children:"Edit"}),e("button",{onClick:v=>{v.stopPropagation(),pe(h.id)},class:"text-red-600 hover:text-red-800",children:"Delete"})]})]})},h.id))})]}),e("div",{class:"bg-white shadow rounded-lg p-6",children:r?e("div",{class:"space-y-4",children:[e("div",{children:[e("h3",{class:"text-lg font-medium text-gray-900",children:r.name}),r.description&&e("p",{class:"text-gray-600 mt-1",children:r.description}),e("p",{class:"text-sm text-gray-500 mt-2",children:["Endpoint: ",e("code",{class:"bg-gray-100 px-1 py-0.5 rounded",children:[r.method," /api/custom/",r.slug]})]})]}),e("div",{children:[e("h4",{class:"font-medium text-gray-900 mb-2",children:"SQL Query"}),e("pre",{class:"bg-gray-50 p-3 rounded text-sm overflow-x-auto",children:r.sql_query})]}),r.parameters&&Array.isArray(r.parameters)&&r.parameters.length>0&&e("div",{children:[e("h4",{class:"font-medium text-gray-900 mb-2",children:"Parameters"}),e("div",{class:"space-y-2",children:r.parameters.map(h=>e("div",{class:"flex items-center gap-2",children:[e("label",{class:"text-sm font-medium text-gray-700 w-32",children:[h.name,h.required&&e("span",{class:"text-red-500",children:"*"})]}),e("input",{type:h.type==="number"?"number":"text",value:E[h.name]||"",onChange:v=>R({...E,[h.name]:v.currentTarget.value}),placeholder:h.default?`Default: ${h.default}`:"",class:"flex-1 px-3 py-1 border border-gray-300 rounded-md"}),e("span",{class:"text-xs text-gray-500",children:h.type})]},h.name))})]}),e("button",{onClick:C,disabled:le,class:"w-full px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:le?"Testing...":"Test Query"}),W&&e("div",{class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:W}),M&&e("div",{children:[e("h4",{class:"font-medium text-gray-900 mb-2",children:"Test Results"}),e("div",{class:"text-sm text-gray-600 mb-2",children:["Rows: ",M.row_count," | Time: ",M.execution_time,"ms"]}),e("div",{class:"bg-gray-50 p-3 rounded overflow-x-auto",children:e("pre",{class:"text-sm",children:JSON.stringify(M.data,null,2)})})]})]}):e("div",{class:"text-center text-gray-500",children:"Select a query to view details"})})]}),(o||d)&&e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e("div",{class:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6",children:[e("h3",{class:"text-lg font-medium text-gray-900 mb-4",children:o?"Create Custom Query":"Edit Custom Query"}),$&&e("div",{class:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:$}),e("div",{class:"space-y-4",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Name"}),e("input",{type:"text",value:b.name,onChange:h=>{const v=h.currentTarget.value;T({...b,name:v,slug:o?k(v):b.slug}),u(D=>{const N={...D};return delete N.name,o&&delete N.slug,N})},class:`mt-1 w-full px-3 py-2 border rounded-md ${_.name?"border-red-500 bg-red-50":"border-gray-300"}`}),_.name&&e("p",{class:"mt-1 text-sm text-red-600",children:_.name})]}),e("div",{children:[e("div",{class:"flex justify-between items-center",children:[e("label",{class:"block text-sm font-medium text-gray-700",children:["Slug",e("span",{class:"text-xs text-gray-500",children:"(auto-generated, but editable)"})]}),e("button",{type:"button",onClick:()=>{T({...b,slug:k(b.name)}),u(h=>{const{slug:v,...D}=h;return D})},class:"text-xs text-indigo-600 hover:text-indigo-800",children:"Re-generate from name"})]}),e("input",{type:"text",value:b.slug,onChange:h=>{T({...b,slug:h.currentTarget.value}),_.slug&&u(v=>{const{slug:D,...N}=v;return N})},placeholder:"lowercase-with-hyphens",class:`mt-1 w-full px-3 py-2 border rounded-md ${_.slug?"border-red-500 bg-red-50":"border-gray-300"}`}),_.slug&&e("p",{class:"mt-1 text-sm text-red-600",children:_.slug}),e("p",{class:"mt-1 text-sm text-gray-500",children:["This will be the API endpoint: /api/custom/",b.slug||"a1b2c3d4"]})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Description"}),e("input",{type:"text",value:b.description,onChange:h=>T({...b,description:h.currentTarget.value}),class:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"SQL Query"}),e("textarea",{value:b.sql_query,onChange:h=>{const v=h.currentTarget.value,D=A(v),N=new Set(b.parameters.map(se=>se.name)),K=[...b.parameters.filter(se=>v.includes(`:${se.name}`)),...D.filter(se=>!N.has(se.name))];T({...b,sql_query:v,parameters:K}),_.sql_query&&u(se=>{const{sql_query:fe,...ae}=se;return ae})},rows:6,placeholder:"SELECT * FROM users WHERE created_at > :start_date",class:`mt-1 w-full px-3 py-2 border rounded-md font-mono text-sm ${_.sql_query?"border-red-500 bg-red-50":"border-gray-300"}`}),_.sql_query&&e("p",{class:"mt-1 text-sm text-red-600",children:_.sql_query}),e("div",{class:"mt-2 flex justify-between items-center",children:[e("p",{class:"text-sm text-gray-500",children:"Use :parameter_name for parameters (will be auto-detected)"}),b.sql_query&&e("div",{class:"flex gap-2",children:[e("span",{class:`px-2 py-1 rounded text-xs ${j(b.sql_query).method==="GET"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:j(b.sql_query).method}),j(b.sql_query).readonly&&e("span",{class:"px-2 py-1 rounded text-xs bg-gray-100 text-gray-800",children:"Read-only"})]})]})]}),e("div",{children:[e("div",{class:"flex justify-between items-center mb-2",children:[e("label",{class:"block text-sm font-medium text-gray-700",children:["Parameters",b.parameters.length>0&&e("span",{class:"text-xs text-gray-500 ml-1",children:["(",b.parameters.length," detected)"]})]}),e("button",{type:"button",onClick:oe,class:"text-sm text-indigo-600 hover:text-indigo-800",children:"Add Parameter"})]}),b.parameters.length===0?e("div",{class:"text-sm text-gray-500 bg-gray-50 p-3 rounded border-2 border-dashed border-gray-200",children:"No parameters detected. Use :param_name in your SQL query to automatically add parameters here."}):b.parameters.map((h,v)=>e("div",{class:"mb-3",children:[e("div",{class:"flex gap-2 mb-1",children:[e("input",{type:"text",value:h.name,onChange:D=>re(v,{name:D.currentTarget.value}),placeholder:"param_name",class:`flex-1 px-3 py-1 border rounded-md text-sm ${_[`parameter_${v}_name`]?"border-red-500 bg-red-50":"border-gray-300"}`}),e("select",{value:h.type,onChange:D=>re(v,{type:D.currentTarget.value}),class:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[e("option",{value:"string",children:"String"}),e("option",{value:"number",children:"Number"}),e("option",{value:"boolean",children:"Boolean"}),e("option",{value:"date",children:"Date"})]}),e("label",{class:"flex items-center",children:[e("input",{type:"checkbox",checked:h.required,onChange:D=>re(v,{required:D.currentTarget.checked}),class:"mr-1"}),e("span",{class:"text-sm",children:"Required"})]}),e("button",{type:"button",onClick:()=>ee(v),class:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]}),_[`parameter_${v}_name`]&&e("p",{class:"text-xs text-red-600 ml-1",children:_[`parameter_${v}_name`]})]},v))]}),e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700",children:"Cache TTL (seconds)"}),e("input",{type:"number",value:b.cache_ttl,onChange:h=>T({...b,cache_ttl:parseInt(h.currentTarget.value)||0}),class:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e("div",{children:e("label",{class:"flex items-center",children:[e("input",{type:"checkbox",checked:b.enabled,onChange:h=>T({...b,enabled:h.currentTarget.checked}),class:"mr-2"}),e("span",{class:"text-sm font-medium text-gray-700",children:"Enabled"})]})})]}),e("div",{class:"flex justify-end gap-2 mt-6",children:[e("button",{onClick:()=>{i(!1),p(!1),P()},class:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e("button",{onClick:o?de:Q,class:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:o?"Create":"Update"})]})]})})]})}function fr(){return e(nr,{children:e(dn,{children:[e(Ce,{path:"/",component:rr}),e(Ce,{path:"/database",component:lr}),e(Ce,{path:"/custom-sql",component:pr}),e(Ce,{path:"/storage",component:cr}),e(Ce,{path:"/auth",component:hr}),e(Ce,{path:"/settings",component:mr})]})})}On(e(fr,{}),document.getElementById("app"));
//# sourceMappingURL=index-DGYRlLmH.js.map
