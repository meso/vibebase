PRAGMA defer_foreign_keys=TRUE;
CREATE TABLE IF NOT EXISTS "admins" (
  id TEXT PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  name TEXT,
  provider TEXT NOT NULL,
  provider_id TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE users (
  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
  email TEXT UNIQUE NOT NULL,
  name TEXT,
  avatar_url TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
, item_id TEXT);
INSERT INTO users VALUES('95437d9618c32dbf7d349584498c2319','user1@example.com','Sample User 1',NULL,'2025-06-12 13:18:10','2025-06-12 13:18:10',NULL);
INSERT INTO users VALUES('71890eb05b2b0de19a93f2f804147357','user2@example.com','Sample User 2',NULL,'2025-06-12 13:18:10','2025-06-12 13:18:10',NULL);
INSERT INTO users VALUES('4lcjwf0ffmlmbudghxh','newuser@example.com','Updated Test User','https://example.com/avatar.jpg','2025-06-13 05:33:25','2025-06-13T05:33:34.556Z',NULL);
CREATE TABLE IF NOT EXISTS "items" (
  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
  name TEXT NOT NULL,
  description TEXT,
  user_id TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, price INTEGER,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
INSERT INTO items VALUES('eafaff7a8b6cceef0c0c949d7176fb00','Sample Item 1','This is a sample item for demonstration','95437d9618c32dbf7d349584498c2319','2025-06-12 13:18:10','2025-06-12 13:18:10',NULL);
INSERT INTO items VALUES('a5676d9ae690d660960158be09fd12b4','Sample Item 2','This is a sample item for demonstration','95437d9618c32dbf7d349584498c2319','2025-06-12 13:18:10','2025-06-12 13:18:10',NULL);
INSERT INTO items VALUES('af864dc410a9b0ef8dfd608ead068c6d','Sample Item 3','This is a sample item for demonstration','95437d9618c32dbf7d349584498c2319','2025-06-12 13:18:10','2025-06-12 13:18:10',NULL);
CREATE TABLE IF NOT EXISTS "messages" ("id" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), "content" TEXT NOT NULL, "from_user_id" TEXT NOT NULL, "to_user_id" TEXT NOT NULL, "created_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "updated_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "item_id" INTEGER, FOREIGN KEY ("from_user_id") REFERENCES "users"("id"));
INSERT INTO messages VALUES('396e1378c936dc72503f51c501bce9c5','ｗｗｗｗｗｗｗｗｗｗｗｗｗｗ','95437d9618c32dbf7d349584498c2319','4lcjwf0ffmlmbudghxh','2025-06-13 14:19:03','2025-06-13T16:21:51.807Z',NULL);
INSERT INTO messages VALUES('e89d8b2776ee0186d7f2d2ba7c1e4bd4','うける〜〜〜','95437d9618c32dbf7d349584498c2319','www','2025-06-13 15:29:31','2025-06-13T16:21:49.877Z',123);
CREATE TABLE d1_migrations(
		id         INTEGER PRIMARY KEY AUTOINCREMENT,
		name       TEXT UNIQUE,
		applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);
CREATE TABLE schema_snapshots (
  id TEXT PRIMARY KEY,
  version INTEGER NOT NULL,
  name TEXT,  -- Optional user-friendly name
  description TEXT,  -- Optional description of changes
  
  -- Schema data
  full_schema TEXT NOT NULL,  -- Complete CREATE statements
  tables_json TEXT NOT NULL,  -- Detailed table information as JSON
  schema_hash TEXT NOT NULL,  -- Hash for quick comparison
  
  -- Metadata
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  created_by TEXT,  -- Admin ID who created the snapshot
  snapshot_type TEXT DEFAULT 'manual',  -- 'manual', 'auto', 'pre_change'
  
  -- D1 Time Travel integration (optional)
  d1_bookmark_id TEXT,  -- D1 bookmark for this snapshot
  
  FOREIGN KEY (created_by) REFERENCES admins(id)
);
INSERT INTO schema_snapshots VALUES('7cbb6e83-ed4b-4f3d-aff1-8279bf2b3a3e',2,'テスト',NULL,replace('CREATE TABLE "admins" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\nCREATE TABLE d1_migrations(\n		id         INTEGER PRIMARY KEY AUTOINCREMENT,\n		name       TEXT UNIQUE,\n		applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\nCREATE TABLE "items" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\nCREATE TABLE "messages" ("id" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), "content" TEXT NOT NULL, "from_user_id" TEXT NOT NULL, "to_user_id" TEXT NOT NULL, "created_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "updated_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "item_id" INTEGER, FOREIGN KEY ("from_user_id") REFERENCES "users"("id"));\nCREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)','\n',char(10)),'[{"name":"admins","sql":"CREATE TABLE \"admins\" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"provider","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"provider_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":5,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"d1_migrations","sql":"CREATE TABLE d1_migrations(\n\t\tid         INTEGER PRIMARY KEY AUTOINCREMENT,\n\t\tname       TEXT UNIQUE,\n\t\tapplied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n)","columns":[{"cid":0,"name":"id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":2,"name":"applied_at","type":"TIMESTAMP","notnull":1,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"items","sql":"CREATE TABLE \"items\" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"description","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"user_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"messages","sql":"CREATE TABLE \"messages\" (\"id\" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), \"content\" TEXT NOT NULL, \"from_user_id\" TEXT NOT NULL, \"to_user_id\" TEXT NOT NULL, \"created_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"updated_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"item_id\" INTEGER, FOREIGN KEY (\"from_user_id\") REFERENCES \"users\"(\"id\"))","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"content","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"from_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":3,"name":"to_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"from_user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"users","sql":"CREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"avatar_url","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[]}]','434ba05bd50035f0cd4f11ca8574638310184b02b5f406973e062de39c16f2f2','2025-06-14 13:33:55',NULL,'manual',NULL);
INSERT INTO schema_snapshots VALUES('b9c8df50-fe85-4673-8726-7c88f9a8c8f5',3,'Snapshot v3','Before adding column price to items',replace('CREATE TABLE "admins" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\nCREATE TABLE d1_migrations(\n		id         INTEGER PRIMARY KEY AUTOINCREMENT,\n		name       TEXT UNIQUE,\n		applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\nCREATE TABLE "items" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\nCREATE TABLE "messages" ("id" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), "content" TEXT NOT NULL, "from_user_id" TEXT NOT NULL, "to_user_id" TEXT NOT NULL, "created_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "updated_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "item_id" INTEGER, FOREIGN KEY ("from_user_id") REFERENCES "users"("id"));\nCREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)','\n',char(10)),'[{"name":"admins","sql":"CREATE TABLE \"admins\" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"provider","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"provider_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":5,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"d1_migrations","sql":"CREATE TABLE d1_migrations(\n\t\tid         INTEGER PRIMARY KEY AUTOINCREMENT,\n\t\tname       TEXT UNIQUE,\n\t\tapplied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n)","columns":[{"cid":0,"name":"id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":2,"name":"applied_at","type":"TIMESTAMP","notnull":1,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"items","sql":"CREATE TABLE \"items\" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"description","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"user_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"messages","sql":"CREATE TABLE \"messages\" (\"id\" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), \"content\" TEXT NOT NULL, \"from_user_id\" TEXT NOT NULL, \"to_user_id\" TEXT NOT NULL, \"created_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"updated_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"item_id\" INTEGER, FOREIGN KEY (\"from_user_id\") REFERENCES \"users\"(\"id\"))","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"content","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"from_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":3,"name":"to_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"from_user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"users","sql":"CREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"avatar_url","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[]}]','434ba05bd50035f0cd4f11ca8574638310184b02b5f406973e062de39c16f2f2','2025-06-14 13:53:05',NULL,'pre_change',NULL);
INSERT INTO schema_snapshots VALUES('751a5664-d4e9-4ae9-a24e-617950f62c66',4,'Snapshot v4','Before adding column price to items',replace('CREATE TABLE "admins" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\nCREATE TABLE d1_migrations(\n		id         INTEGER PRIMARY KEY AUTOINCREMENT,\n		name       TEXT UNIQUE,\n		applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\nCREATE TABLE "items" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\nCREATE TABLE "messages" ("id" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), "content" TEXT NOT NULL, "from_user_id" TEXT NOT NULL, "to_user_id" TEXT NOT NULL, "created_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "updated_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "item_id" INTEGER, FOREIGN KEY ("from_user_id") REFERENCES "users"("id"));\nCREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)','\n',char(10)),'[{"name":"admins","sql":"CREATE TABLE \"admins\" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"provider","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"provider_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":5,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"d1_migrations","sql":"CREATE TABLE d1_migrations(\n\t\tid         INTEGER PRIMARY KEY AUTOINCREMENT,\n\t\tname       TEXT UNIQUE,\n\t\tapplied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n)","columns":[{"cid":0,"name":"id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":2,"name":"applied_at","type":"TIMESTAMP","notnull":1,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"items","sql":"CREATE TABLE \"items\" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"description","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"user_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"messages","sql":"CREATE TABLE \"messages\" (\"id\" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), \"content\" TEXT NOT NULL, \"from_user_id\" TEXT NOT NULL, \"to_user_id\" TEXT NOT NULL, \"created_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"updated_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"item_id\" INTEGER, FOREIGN KEY (\"from_user_id\") REFERENCES \"users\"(\"id\"))","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"content","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"from_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":3,"name":"to_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"from_user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"users","sql":"CREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"avatar_url","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[]}]','434ba05bd50035f0cd4f11ca8574638310184b02b5f406973e062de39c16f2f2','2025-06-14 13:53:10',NULL,'pre_change',NULL);
INSERT INTO schema_snapshots VALUES('91e28037-ebd4-425d-9efd-136261c9561e',5,'Snapshot v5','Added column price to items',replace('CREATE TABLE "admins" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\nCREATE TABLE d1_migrations(\n		id         INTEGER PRIMARY KEY AUTOINCREMENT,\n		name       TEXT UNIQUE,\n		applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\nCREATE TABLE "items" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, price INTEGER,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\nCREATE TABLE "messages" ("id" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), "content" TEXT NOT NULL, "from_user_id" TEXT NOT NULL, "to_user_id" TEXT NOT NULL, "created_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "updated_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "item_id" INTEGER, FOREIGN KEY ("from_user_id") REFERENCES "users"("id"));\nCREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)','\n',char(10)),'[{"name":"admins","sql":"CREATE TABLE \"admins\" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"provider","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"provider_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":5,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"d1_migrations","sql":"CREATE TABLE d1_migrations(\n\t\tid         INTEGER PRIMARY KEY AUTOINCREMENT,\n\t\tname       TEXT UNIQUE,\n\t\tapplied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n)","columns":[{"cid":0,"name":"id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":2,"name":"applied_at","type":"TIMESTAMP","notnull":1,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"items","sql":"CREATE TABLE \"items\" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, price INTEGER,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"description","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"user_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"price","type":"INTEGER","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"messages","sql":"CREATE TABLE \"messages\" (\"id\" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), \"content\" TEXT NOT NULL, \"from_user_id\" TEXT NOT NULL, \"to_user_id\" TEXT NOT NULL, \"created_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"updated_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"item_id\" INTEGER, FOREIGN KEY (\"from_user_id\") REFERENCES \"users\"(\"id\"))","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"content","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"from_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":3,"name":"to_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"from_user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"users","sql":"CREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"avatar_url","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[]}]','5be428bc0f0be91f9230af8c760f7142d9105cab7e4557b3cfb2e81ea247b234','2025-06-14 13:53:11',NULL,'auto',NULL);
INSERT INTO schema_snapshots VALUES('c9d12fef-0d97-40ee-b5ab-7b1b5d4b74ce',6,'テスト',NULL,replace('CREATE TABLE "admins" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\nCREATE TABLE d1_migrations(\n		id         INTEGER PRIMARY KEY AUTOINCREMENT,\n		name       TEXT UNIQUE,\n		applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\nCREATE TABLE "items" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, price INTEGER,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\nCREATE TABLE "messages" ("id" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), "content" TEXT NOT NULL, "from_user_id" TEXT NOT NULL, "to_user_id" TEXT NOT NULL, "created_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "updated_at" DATETIME DEFAULT CURRENT_TIMESTAMP, "item_id" INTEGER, FOREIGN KEY ("from_user_id") REFERENCES "users"("id"));\nCREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)','\n',char(10)),'[{"name":"admins","sql":"CREATE TABLE \"admins\" (\n  id TEXT PRIMARY KEY,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  provider TEXT NOT NULL,\n  provider_id TEXT NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"provider","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"provider_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":5,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"d1_migrations","sql":"CREATE TABLE d1_migrations(\n\t\tid         INTEGER PRIMARY KEY AUTOINCREMENT,\n\t\tname       TEXT UNIQUE,\n\t\tapplied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n)","columns":[{"cid":0,"name":"id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":2,"name":"applied_at","type":"TIMESTAMP","notnull":1,"dflt_value":"CURRENT_TIMESTAMP","pk":0}],"foreignKeys":[]},{"name":"items","sql":"CREATE TABLE \"items\" (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  name TEXT NOT NULL,\n  description TEXT,\n  user_id TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, price INTEGER,\n  FOREIGN KEY (user_id) REFERENCES users(id)\n)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"name","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"description","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"user_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"price","type":"INTEGER","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"messages","sql":"CREATE TABLE \"messages\" (\"id\" TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))), \"content\" TEXT NOT NULL, \"from_user_id\" TEXT NOT NULL, \"to_user_id\" TEXT NOT NULL, \"created_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"updated_at\" DATETIME DEFAULT CURRENT_TIMESTAMP, \"item_id\" INTEGER, FOREIGN KEY (\"from_user_id\") REFERENCES \"users\"(\"id\"))","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"content","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"from_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":3,"name":"to_user_id","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"INTEGER","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[{"id":0,"seq":0,"table":"users","from":"from_user_id","to":"id","on_update":"NO ACTION","on_delete":"NO ACTION","match":"NONE"}]},{"name":"users","sql":"CREATE TABLE users (\n  id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n  email TEXT UNIQUE NOT NULL,\n  name TEXT,\n  avatar_url TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n, item_id TEXT)","columns":[{"cid":0,"name":"id","type":"TEXT","notnull":0,"dflt_value":"lower(hex(randomblob(16)))","pk":1},{"cid":1,"name":"email","type":"TEXT","notnull":1,"dflt_value":null,"pk":0},{"cid":2,"name":"name","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":3,"name":"avatar_url","type":"TEXT","notnull":0,"dflt_value":null,"pk":0},{"cid":4,"name":"created_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":5,"name":"updated_at","type":"DATETIME","notnull":0,"dflt_value":"CURRENT_TIMESTAMP","pk":0},{"cid":6,"name":"item_id","type":"TEXT","notnull":0,"dflt_value":null,"pk":0}],"foreignKeys":[]}]','5be428bc0f0be91f9230af8c760f7142d9105cab7e4557b3cfb2e81ea247b234','2025-06-14 13:58:49',NULL,'manual',NULL);
CREATE TABLE schema_snapshot_counter (
  id INTEGER PRIMARY KEY CHECK (id = 1),  -- Ensure only one row
  current_version INTEGER DEFAULT 0
);
INSERT INTO schema_snapshot_counter VALUES(1,6);
DELETE FROM sqlite_sequence;
CREATE INDEX idx_schema_snapshots_version ON schema_snapshots(version DESC);
CREATE INDEX idx_schema_snapshots_created_at ON schema_snapshots(created_at DESC);
